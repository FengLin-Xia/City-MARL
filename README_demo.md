# 最小单元 Demo - 城市仿真

这是一个无RL、无固化的纯规则驱动城市仿真Demo，展示两个交通枢纽和一段主干道的城市发展过程。

## 项目结构

```
├── configs/
│   └── colors.json          # 颜色配置文件
├── data/
│   ├── poi.json            # 初始POI数据
│   └── poi_example.json    # 示例POI数据
├── logic/
│   ├── placement.py        # 政府/企业布点逻辑
│   ├── schedule.py         # 居民日程生成
│   └── move.py            # 移动逻辑（直线/A*）
├── viz/
│   └── ide.py             # 可视化渲染
├── main_demo.py           # 主程序
└── output_frames/         # 输出图片目录
```

## 功能特性

### 角色与颜色
- **政府（蓝色系）**：枢纽(hub)、学校(school)、诊所(clinic)、绿地(park)
- **企业（橙/黄色）**：商业(retail)、住宅(residential)
- **居民**：动态白点，轨迹沉积热力

### 核心规则
1. **居民移动**：直线插值或A*路径规划
2. **热力沉积**：每步在热力图 H[x,y] += 1/(1+local_cost)
3. **政府补点**：平均到达时间>12分钟且覆盖率<80%时补建公共设施
4. **企业扩容**：到访/容量>0.8连续3日时复制同类POI

### 时间线
- 步长：10分钟
- 每日迁入：100人（受住宅容量限制）
- 居民日程：home→work→shop→home

## 运行方法

### 1. 安装依赖
```bash
pip install numpy matplotlib
```

### 2. 运行仿真
```bash
python main_demo.py
```

### 3. 使用示例数据
```bash
# 修改main_demo.py中的config_file参数
simulation = CitySimulation('data/poi_example.json')
```

## 输出结果

程序会生成以下输出：
- `output_frames/` 目录下的PNG图片序列
- 每日结束时的城市状态图片
- 新增POI的高亮显示

## 参数配置

### 仿真参数
- `days`: 仿真天数（默认10天）
- `steps_per_day`: 每日步数（默认144步，10分钟/步）
- `daily_quota`: 每日新增居民数（默认100人）
- `speed_px`: 移动速度（默认4像素/步）
- `heat_evaporation`: 热力蒸发率（默认0.98）

### 阈值参数
- 政府补点阈值：平均到达时间>12分钟 & 覆盖率<80%
- 企业扩容阈值：到访/容量>0.8连续3日
- 移动速度：4像素/步

## 可视化说明

### 图层渲染顺序
1. 热力图（半透明）
2. 主干线（灰色粗线）
3. 枢纽（深蓝大圆点）
4. 公共POI（蓝/青/绿，不同形状）
5. 住宅POI（黄方形）
6. 商业POI（橙圆形）
7. 新增POI高亮（红色边框）

### 颜色编码
- 枢纽：深蓝色 (#0B5ED7)
- 学校：青色 (#22A6B3)
- 诊所：蓝色 (#3CA6FF)
- 绿地：绿色 (#2ECC71)
- 住宅：黄色 (#F6C344)
- 商业：橙色 (#FD7E14)
- 主干线：灰色 (#9AA4B2)

## 验收标准

运行10天后应观察到：
1. 热力在枢纽—商业—住宅之间形成清晰走廊
2. 公共POI新增能显著降低目标区域平均到达时间
3. 企业在热力热点周边成功复制
4. 可视化按颜色区分类型，热力叠加明显

## 扩展功能

### 可配置选项
- 修改 `configs/colors.json` 自定义颜色
- 编辑 `data/poi.json` 调整初始POI布局
- 在 `main_demo.py` 中调整仿真参数

### 可扩展模块
- 添加更复杂的路径规划算法
- 实现更真实的统计计算
- 增加更多POI类型和交互规则
- 支持多层级路网结构



