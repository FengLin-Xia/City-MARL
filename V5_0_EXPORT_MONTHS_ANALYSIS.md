# v5.0 å¯¼å‡ºæœˆä»½æ•°æ®é—®é¢˜åˆ†æ

## ğŸ” é—®é¢˜æè¿°

**ç°è±¡**: v5.0è®­ç»ƒååªå¯¼å‡ºäº†3ä¸ªæœˆçš„æ•°æ®ï¼Œè€Œä¸æ˜¯é…ç½®çš„30ä¸ªæœˆã€‚

**é…ç½®**: `total_steps: 30` (30ä¸ªæœˆ)

**å®é™…å¯¼å‡º**: åªæœ‰ month_00, month_01, month_02 ä¸‰ä¸ªæ–‡ä»¶

## ğŸ“Š é—®é¢˜åˆ†æ

### **1. æ—¶é—´æ­¥ä¸æœˆä»½çš„å…³ç³»**

#### **ç¯å¢ƒé…ç½®**
```json
"time_model": { "step_unit": "month", "total_steps": 30 }
```

#### **ç¯å¢ƒå®ç°é€»è¾‘**
```python
def _should_switch_month(self) -> bool:
    """æ£€æŸ¥æ˜¯å¦éœ€è¦åˆ‡æ¢æœˆä»½"""
    # ç®€åŒ–å®ç°ï¼šæ¯12æ­¥åˆ‡æ¢ä¸€ä¸ªæœˆ
    return self.current_step % 12 == 0
```

#### **é—®é¢˜æ ¹æº**
- **é…ç½®**: 30ä¸ªæœˆ = 30ä¸ªæ—¶é—´å•ä½
- **å®ç°**: æ¯12æ­¥ = 1ä¸ªæœˆ
- **ç»“æœ**: 30æ­¥ Ã· 12 = 2.5ä¸ªæœˆ (å®é™…åªæœ‰2-3ä¸ªæœˆ)

### **2. è®­ç»ƒå™¨æ”¶é›†ç»éªŒ**

#### **è®­ç»ƒå™¨é€»è¾‘**
```python
def collect_experience(self, num_steps: int) -> List[Dict]:
    # æ”¶é›†30æ­¥ç»éªŒ
    experiences = self.trainer.collect_experience(30)
```

#### **ç¯å¢ƒå“åº”**
- **æ­¥éª¤0-11**: æœˆä»½0
- **æ­¥éª¤12-23**: æœˆä»½1  
- **æ­¥éª¤24-35**: æœˆä»½2
- **æ­¥éª¤36+**: æœˆä»½3+ (ä½†åªæ”¶é›†åˆ°30æ­¥)

### **3. å¯¼å‡ºç³»ç»Ÿå¤„ç†**

#### **åˆ†ç»„é€»è¾‘**
```python
def _group_by_month(self, step_logs, env_states):
    for log, state in zip(step_logs, env_states):
        month = state.month  # ä½¿ç”¨ç¯å¢ƒçŠ¶æ€çš„æœˆä»½
        # åªæœ‰æœˆä»½0, 1, 2çš„æ•°æ®
```

## ğŸ¯ è§£å†³æ–¹æ¡ˆ

### **æ–¹æ¡ˆ1: ä¿®æ­£ç¯å¢ƒæœˆä»½åˆ‡æ¢é€»è¾‘**

#### **å½“å‰å®ç°**
```python
def _should_switch_month(self) -> bool:
    return self.current_step % 12 == 0  # æ¯12æ­¥ä¸€ä¸ªæœˆ
```

#### **ä¿®æ­£å®ç°**
```python
def _should_switch_month(self) -> bool:
    # æ¯1æ­¥ä¸€ä¸ªæœˆ (ç¬¦åˆé…ç½®)
    return True
```

### **æ–¹æ¡ˆ2: ä¿®æ­£é…ç½®ç†è§£**

#### **å½“å‰ç†è§£**
- `total_steps: 30` = 30ä¸ªæœˆ
- æ¯12æ­¥ = 1ä¸ªæœˆ
- 30æ­¥ = 2.5ä¸ªæœˆ

#### **æ­£ç¡®ç†è§£**
- `total_steps: 30` = 30æ­¥
- æ¯1æ­¥ = 1ä¸ªæœˆ  
- 30æ­¥ = 30ä¸ªæœˆ

### **æ–¹æ¡ˆ3: é…ç½®é©±åŠ¨æœˆä»½åˆ‡æ¢**

#### **é…ç½®æ·»åŠ **
```json
"env": {
  "time_model": { 
    "step_unit": "month", 
    "total_steps": 30,
    "steps_per_month": 1  // æ–°å¢ï¼šæ¯æ­¥ä¸€ä¸ªæœˆ
  }
}
```

#### **ç¯å¢ƒå®ç°**
```python
def _should_switch_month(self) -> bool:
    steps_per_month = self.config.get("env", {}).get("time_model", {}).get("steps_per_month", 1)
    return self.current_step % steps_per_month == 0
```

## ğŸ”§ æ¨èä¿®å¤

### **ç«‹å³ä¿®å¤ (æ–¹æ¡ˆ1)**

ä¿®æ”¹ `envs/v5_0/city_env.py`:

```python
def _should_switch_month(self) -> bool:
    """æ£€æŸ¥æ˜¯å¦éœ€è¦åˆ‡æ¢æœˆä»½"""
    # æ¯1æ­¥åˆ‡æ¢ä¸€ä¸ªæœˆ (ç¬¦åˆtotal_stepsé…ç½®)
    return True
```

### **é•¿æœŸä¼˜åŒ– (æ–¹æ¡ˆ3)**

1. **æ·»åŠ é…ç½®å‚æ•°**:
   ```json
   "env": {
     "time_model": { 
       "step_unit": "month", 
       "total_steps": 30,
       "steps_per_month": 1
     }
   }
   ```

2. **ä¿®æ”¹ç¯å¢ƒé€»è¾‘**:
   ```python
   def _should_switch_month(self) -> bool:
       steps_per_month = self.config.get("env", {}).get("time_model", {}).get("steps_per_month", 1)
       return self.current_step % steps_per_month == 0
   ```

## ğŸ“ˆ é¢„æœŸç»“æœ

### **ä¿®å¤å**
- **30æ­¥ç»éªŒ** â†’ **30ä¸ªæœˆæ•°æ®**
- **å¯¼å‡ºæ–‡ä»¶**: month_00 åˆ° month_29
- **å®Œå…¨ç¬¦åˆé…ç½®**: `total_steps: 30`

### **éªŒè¯æ–¹æ³•**
```bash
python enhanced_city_simulation_v5_0.py --episodes 1 --verbose
# åº”è¯¥çœ‹åˆ°: Exported month 0 åˆ° month 29
```

## ğŸ¯ æ€»ç»“

**é—®é¢˜æ ¹æº**: ç¯å¢ƒæœˆä»½åˆ‡æ¢é€»è¾‘ä¸é…ç½®ä¸åŒ¹é…
- **é…ç½®**: 30ä¸ªæœˆ
- **å®ç°**: æ¯12æ­¥1ä¸ªæœˆ
- **ç»“æœ**: åªæœ‰2-3ä¸ªæœˆæ•°æ®

**è§£å†³æ–¹æ¡ˆ**: ä¿®æ”¹ç¯å¢ƒæœˆä»½åˆ‡æ¢é€»è¾‘ï¼Œä½¿å…¶ä¸é…ç½®ä¸€è‡´
- **æ¯1æ­¥**: 1ä¸ªæœˆ
- **30æ­¥**: 30ä¸ªæœˆ
- **å®Œå…¨ç¬¦åˆ**: `total_steps: 30` é…ç½®

**è¿™æ˜¯é…ç½®ä¸å®ç°ä¸ä¸€è‡´çš„å…¸å‹é—®é¢˜ï¼** ğŸ¯

