# V4.1 Rewardä¸Costæœºåˆ¶åˆ†æ

## ç›®å½•
1. [ç³»ç»Ÿæ¦‚è§ˆ](#ç³»ç»Ÿæ¦‚è§ˆ)
2. [Costè®¡ç®—è¯¦è§£](#costè®¡ç®—è¯¦è§£)
3. [Rewardè®¡ç®—è¯¦è§£](#rewardè®¡ç®—è¯¦è§£)
4. [RLè®­ç»ƒä¸­çš„Rewardç»„æˆ](#rlè®­ç»ƒä¸­çš„rewardç»„æˆ)
5. [æ½œåœ¨é—®é¢˜](#æ½œåœ¨é—®é¢˜)
6. [å…·ä½“æ¡ˆä¾‹åˆ†æ](#å…·ä½“æ¡ˆä¾‹åˆ†æ)

---

## ç³»ç»Ÿæ¦‚è§ˆ

V4.1é‡‡ç”¨**åŒå±‚è®¾è®¡**ï¼š
1. **ActionScorerå±‚**ï¼šè®¡ç®—æ¯ä¸ªåŠ¨ä½œçš„cost/reward/prestige/score
2. **Environmentå±‚**ï¼šåŸºäºactionçš„å±æ€§è®¡ç®—RLè®­ç»ƒç”¨çš„total_reward

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ActionScorer                          â”‚
â”‚  è®¡ç®—åŸå§‹ç»æµæŒ‡æ ‡ (cost/reward/prestige/score)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Environment                           â”‚
â”‚  åŸºäºactionå±æ€§ â†’ è®¡ç®—RLçš„total_reward                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Costè®¡ç®—è¯¦è§£

### å…¬å¼ï¼ˆåœ¨`logic/v4_enumeration.py`ä¸­ï¼‰

```python
# INDçš„å»ºé€ æˆæœ¬
cost = BaseCost_IND[size] + ZC[zone] + LP_value

å…¶ä¸­ï¼š
- BaseCost_IND = {'S': 900, 'M': 1500, 'L': 2400}  # åŸºç¡€å»ºé€ æˆæœ¬ï¼ˆkGBPï¼‰
- ZC = {'near': 200, 'mid': 100, 'far': 0}         # åŒºä½é™„åŠ æˆæœ¬ï¼ˆkGBPï¼‰
- LP_value = LP_idx * LandPriceBase                 # åœ°ä»·æˆæœ¬ï¼ˆkGBPï¼‰
  - LP_idx = 10~100 (åŸºäºLP_norm = 0~1çº¿æ€§æ˜ å°„)
  - LandPriceBase = 11.0 (é»˜è®¤å€¼)
  - LP_valueèŒƒå›´ï¼š110~1100
```

### å…¸å‹æˆæœ¬èŒƒå›´

| Size | BaseCost | Zoneå½±å“ | LPå½±å“ | æ€»æˆæœ¬èŒƒå›´ |
|------|----------|---------|--------|-----------|
| Så‹  | 900      | +0~200  | +110~1100 | **1010~2200 kGBP** |
| Må‹  | 1500     | +0~200  | +110~1100 | **1610~2800 kGBP** |
| Lå‹  | 2400     | +0~200  | +110~1100 | **2510~3700 kGBP** |

**æ³¨æ„**ï¼šcostæ˜¯**ä¸€æ¬¡æ€§**å»ºè®¾æŠ•å…¥ã€‚

---

## Rewardè®¡ç®—è¯¦è§£

### å…¬å¼ï¼ˆåœ¨`logic/v4_enumeration.py`ä¸­ï¼‰

```python
# INDçš„æœˆåº¦æ”¶ç›Š
reward_base = RevBase_IND[size] + ZR[zone] + Adj_bonus*is_adj - OPEX_IND[size] - Rent[size] + river_premium

# LPå¢ç›Š
reward = reward_base * (1 + RewardLP_k * LP_norm)

å…¶ä¸­ï¼š
- RevBase_IND = {'S': 180, 'M': 320, 'L': 520}     # åŸºç¡€æœˆæ”¶å…¥ï¼ˆkGBP/æœˆï¼‰
- ZR = {'near': 80, 'mid': 40, 'far': 0}           # åŒºä½æ”¶å…¥åŠ æˆï¼ˆkGBP/æœˆï¼‰
- OPEX_IND = {'S': 100, 'M': 180, 'L': 300}        # è¿è¥æˆæœ¬ï¼ˆkGBP/æœˆï¼‰
- Rent = {'S': 25, 'M': 45, 'L': 70}               # ç§Ÿé‡‘æ”¯å‡ºï¼ˆkGBP/æœˆï¼‰
- RewardLP_k = 0.25 (INDçš„LPå¢ç›Šç³»æ•°)
- Adj_bonus = 0 (é»˜è®¤)
- river_premiumï¼šæ²³æµè·ç¦»æº¢ä»·ï¼ˆ0~å‡ ç™¾ï¼‰
```

### å…¸å‹æ”¶ç›Šè®¡ç®—ç¤ºä¾‹

**Så‹å»ºç­‘ï¼ˆzone=near, LP_norm=0.8ï¼‰**ï¼š
```
reward_base = 180 + 80 + 0 - 100 - 25 + 0 = 135
reward = 135 * (1 + 0.25 * 0.8) = 135 * 1.2 = 162 kGBP/æœˆ
```

**Må‹å»ºç­‘ï¼ˆzone=near, LP_norm=0.8ï¼‰**ï¼š
```
reward_base = 320 + 80 + 0 - 180 - 45 + 0 = 175
reward = 175 * (1 + 0.25 * 0.8) = 175 * 1.2 = 210 kGBP/æœˆ
```

**Lå‹å»ºç­‘ï¼ˆzone=near, LP_norm=0.8ï¼‰**ï¼š
```
reward_base = 520 + 80 + 0 - 300 - 70 + 0 = 230
reward = 230 * (1 + 0.25 * 0.8) = 230 * 1.2 = 276 kGBP/æœˆ
```

### å…¸å‹æ”¶ç›ŠèŒƒå›´

| Size | åŸºç¡€æ”¶ç›Š | LPå¢ç›Šå | æœˆæ”¶ç›ŠèŒƒå›´ |
|------|---------|---------|-----------|
| Så‹  | 55~135  | 55~168  | **55~170 kGBP/æœˆ** |
| Må‹  | 95~175  | 95~218  | **95~220 kGBP/æœˆ** |
| Lå‹  | 150~230 | 150~287 | **150~290 kGBP/æœˆ** |

**æ³¨æ„**ï¼šrewardæ˜¯**æ¯æœˆæŒç»­**çš„è¿è¥æ”¶ç›Šã€‚

---

## RLè®­ç»ƒä¸­çš„Rewardç»„æˆ

### Environment._calculate_reward()çš„å®Œæ•´æµç¨‹

```python
# ä½ç½®ï¼šenvs/v4_1/city_env.py

def _calculate_reward(self, agent: str, action: Action) -> float:
    # ===== ç¬¬1éƒ¨åˆ†ï¼šåŸºç¡€å¥–åŠ± =====
    base_reward = action.reward  # ä½¿ç”¨æœˆåº¦æ”¶ç›Šï¼ˆ55~290ï¼‰
    
    # ===== ç¬¬2éƒ¨åˆ†ï¼šè´¨é‡å¥–åŠ± =====
    quality_reward = 0
    quality_reward += action.reward * 0.01      # rewardå†æ¬¡è®¡å…¥ï¼ˆ0.55~2.9ï¼‰
    quality_reward += action.prestige * 10.0    # å£°æœ›æ”¾å¤§10å€ï¼ˆ-1~10ï¼‰
    quality_reward -= action.cost * 0.001       # costæƒ©ç½šï¼ˆ-1~-3.7ï¼‰
    # è´¨é‡å¥–åŠ±èŒƒå›´ï¼š-4.7 ~ 9.2
    
    # ===== ç¬¬3éƒ¨åˆ†ï¼šè¿›åº¦å¥–åŠ± =====
    progress_reward = len(buildings) * 0.1      # å»ºç­‘æ•°é‡å¥–åŠ±ï¼ˆ0~4ï¼‰
    
    # ===== ç¬¬4éƒ¨åˆ†ï¼šåä½œå¥–åŠ± =====
    cooperation_bonus = 0
    if cooperation_lambda > 0:  # = 0.2
        # åŠŸèƒ½äº’è¡¥ï¼šå…¶ä»–agentå»ºç­‘æ•° * 0.05
        cooperation_bonus += other_buildings_count * 0.05
        # ç©ºé—´åè°ƒï¼šè·ç¦»5-20å•ä½ â†’ +0.02
        cooperation_bonus += spatial_coordination * 0.02
    cooperation_bonus *= 0.2  # æœ€ç»ˆï¼š0.01~0.2
    
    # ===== ç¬¬5éƒ¨åˆ†ï¼šBudgetæƒ©ç½š =====
    budget_penalty = 0
    budget -= action.cost           # æ”¯ä»˜å»ºé€ æˆæœ¬ï¼ˆ-1010~-3700ï¼‰
    budget += action.reward         # è·å¾—ä¸€ä¸ªæœˆæ”¶ç›Šï¼ˆ+55~290ï¼‰
    
    if budget < 0:
        budget_penalty = abs(budget) * debt_penalty_coef  # 0.1
    
    if budget < bankruptcy_threshold:  # -5000
        budget_penalty += 100.0
    
    # ===== æ€»å¥–åŠ± =====
    total_reward = base_reward + quality_reward + progress_reward + cooperation_bonus - budget_penalty
    
    # ===== ç¼©æ”¾ï¼ˆé€ç»™PPOï¼‰ =====
    scaled_reward = total_reward / 200.0
    scaled_reward = np.clip(scaled_reward, -10.0, 10.0)
    
    return scaled_reward
```

### å„éƒ¨åˆ†è´¡çŒ®åº¦

| ç»„ä»¶ | æ•°å€¼èŒƒå›´ | å æ¯” | è¯´æ˜ |
|------|---------|------|------|
| **base_reward** | 55~290 | **70-95%** | ä¸»å¯¼å› ç´  |
| **quality_reward** | -5~+9 | 2-5% | å½±å“å¾ˆå° |
| **progress_reward** | 0~4 | 1-2% | å½±å“å¾ˆå° |
| **cooperation_bonus** | 0~0.2 | <0.1% | **å‡ ä¹æ— å½±å“** |
| **budget_penalty** | 0~å‡ åƒ | **å¯èƒ½å‹å€’ä¸€åˆ‡** | ç ´äº§åä¸»å¯¼ |

### Total Rewardå…¸å‹å€¼

**æ­£å¸¸æƒ…å†µï¼ˆbudgetå……è¶³ï¼‰**ï¼š
```
total_reward = 162 + 2 + 2 + 0.1 - 0 = 166
scaled_reward = 166 / 200 = 0.83
```

**ç ´äº§æƒ…å†µï¼ˆbudget=-10000ï¼‰**ï¼š
```
budget_penalty = 10000 * 0.1 + 100 = 1100
total_reward = 162 + 2 + 2 + 0.1 - 1100 = -934
scaled_reward = -934 / 200 = -4.67
```

---

## æ½œåœ¨é—®é¢˜

### é—®é¢˜1ï¼šCostå’ŒRewardçš„æ—¶é—´ç»´åº¦ä¸ä¸€è‡´ âš ï¸

**é—®é¢˜æè¿°**ï¼š
- `cost`æ˜¯ä¸€æ¬¡æ€§æŠ•å…¥ï¼ˆ1010~3700 kGBPï¼‰
- `reward`æ˜¯æœˆåº¦æ”¶ç›Šï¼ˆ55~290 kGBP/æœˆï¼‰
- Budgetç³»ç»Ÿå°†ä¸¤è€…ç›´æ¥ç›¸å‡ï¼š`budget = budget - cost + reward`

**é—®é¢˜æ‰€åœ¨**ï¼š
```python
# ç¬¬1ä¸ªæœˆ
budget = 15000 - 2000(cost) + 162(reward) = 13162  # å‡€æ”¯å‡º1838

# å¦‚æœåªçœ‹ä¸€ä¸ªæœˆï¼Œæ‰€æœ‰å»ºç­‘éƒ½æ˜¯"äºæŸ"çš„ï¼
# å®é™…ä¸Šéœ€è¦ cost/reward = 2000/162 â‰ˆ 12.3ä¸ªæœˆæ‰èƒ½å›æœ¬
```

**ç»æµå­¦è§’åº¦**ï¼š
- åº”è¯¥ç”¨NPVï¼ˆå‡€ç°å€¼ï¼‰è¯„ä¼°ï¼š`NPV = -cost + Î£(reward / (1+r)^t)`
- æˆ–è€…åªåœ¨ç¬¬ä¸€ä¸ªæœˆæ‰£costï¼Œåç»­æ¯æœˆåŠ reward
- å½“å‰å®ç°ï¼š**æ¯æ¬¡å»ºç­‘éƒ½æ‰£costï¼Œä½†åªåŠ ä¸€æ¬¡reward**

**å½±å“**ï¼š
- å¯¼è‡´è®­ç»ƒåˆæœŸå¿…ç„¶å‡ºç°è´Ÿreturn
- RLè¯¯ä»¥ä¸º"å»ºç­‘=äºé’±"
- å¯¼è‡´è¿‡åº¦ä¿å®ˆç­–ç•¥

---

### é—®é¢˜2ï¼šRewardçš„é‡å¤è®¡ç®— âš ï¸

**é—®é¢˜æè¿°**ï¼š
`action.reward`åœ¨total_rewardä¸­è¢«ç”¨äº†**3æ¬¡**ï¼š

```python
base_reward = action.reward           # ç¬¬1æ¬¡ï¼šä½œä¸ºä¸»è¦å¥–åŠ±ï¼ˆ162ï¼‰
quality_reward += action.reward * 0.01  # ç¬¬2æ¬¡ï¼šè´¨é‡åŠ æˆï¼ˆ+1.62ï¼‰
budget += action.reward                # ç¬¬3æ¬¡ï¼šå½±å“budget_penaltyï¼ˆé—´æ¥ï¼‰
```

**å½±å“**ï¼š
- æ”¾å¤§äº†rewardçš„å½±å“ï¼ˆè™½ç„¶ç¬¬2æ¬¡åªæœ‰1%ï¼‰
- è®¾è®¡ä¸æ¸…æ™°ï¼Œéš¾ä»¥è°ƒè¯•
- å¦‚æœæœªæ¥ä¿®æ”¹rewardè®¡ç®—ï¼Œéœ€è¦æ”¹3å¤„

**å»ºè®®**ï¼š
åªä½¿ç”¨ä¸€æ¬¡ï¼Œæ˜ç¡®è¯­ä¹‰ï¼š
```python
# æ–¹æ¡ˆAï¼šåªç”¨base_reward
total_reward = action.reward + progress + cooperation - budget_penalty

# æ–¹æ¡ˆBï¼šåˆ†ç¦»ç»æµå’Œç­–ç•¥
economic_value = action.reward - action.cost / expected_lifetime
strategic_value = progress + cooperation
total_reward = economic_value + strategic_value
```

---

### é—®é¢˜3ï¼šCostçš„åŒé‡ä½¿ç”¨ âš ï¸

**é—®é¢˜æè¿°**ï¼š
`action.cost`ä¹Ÿè¢«ç”¨äº†2æ¬¡ï¼š

```python
quality_reward -= action.cost * 0.001  # ç¬¬1æ¬¡ï¼šè´¨é‡æƒ©ç½šï¼ˆ-2ï¼‰
budget -= action.cost                  # ç¬¬2æ¬¡ï¼šé¢„ç®—æ‰£é™¤ï¼ˆ-2000ï¼‰
```

**é—®é¢˜æ‰€åœ¨**ï¼š
- ç¬¬1æ¬¡çš„æƒé‡ï¼ˆ0.001ï¼‰å¤ªå°ï¼Œå‡ ä¹æ— å½±å“ï¼ˆ-2 vs 162çš„base_rewardï¼‰
- ç¬¬2æ¬¡çš„å½±å“å·¨å¤§ï¼ˆç›´æ¥æ‰£é™¤2000ï¼‰
- ä¸¤æ¬¡ä½¿ç”¨çš„è¯­ä¹‰ä¸åŒï¼šä¸€ä¸ªæ˜¯"è´¨é‡æƒè¡¡"ï¼Œä¸€ä¸ªæ˜¯"è´¢åŠ¡çº¦æŸ"

**å½±å“**ï¼š
- `quality_reward`ä¸­çš„costæƒ©ç½šå½¢åŒè™šè®¾
- Budgetç³»ç»Ÿä¸»å¯¼äº†costçš„å½±å“

---

### é—®é¢˜4ï¼šActionScorerçš„scoreè¢«å®Œå…¨å¿½ç•¥ âš ï¸

**é—®é¢˜æè¿°**ï¼š
ActionScorerç²¾å¿ƒè®¾è®¡çš„ç»¼åˆè¯„åˆ†ç³»ç»Ÿè¢«ç»•è¿‡ï¼š

```python
# ActionScorerè®¡ç®—ï¼ˆlogic/v4_enumeration.pyï¼‰
score = 0.5 * norm(reward) + 0.3 * norm(prestige) - 0.2 * norm(cost)
# è¿™ä¸ªscoreåœ¨[0, 1]åŒºé—´ï¼Œå¹³è¡¡äº†ä¸‰ä¸ªç»´åº¦

# ä½†Environmentå®Œå…¨ä¸ç”¨è¿™ä¸ªscoreï¼
base_reward = action.reward  # ç›´æ¥ç”¨åŸå§‹rewardï¼Œå¿½ç•¥äº†prestigeå’Œcostçš„å¹³è¡¡
```

**ActionScorerçš„è®¾è®¡æ„å›¾**ï¼š
- å½’ä¸€åŒ–ç¡®ä¿å„ç»´åº¦å…¬å¹³æ¯”è¾ƒ
- æƒé‡ä½“ç°è®¾è®¡è€…çš„ä»·å€¼è§‚ï¼ˆrewardæœ€é‡è¦0.5ï¼Œprestigeæ¬¡ä¹‹0.3ï¼Œcostæœ€è½»0.2ï¼‰
- é€‚ç”¨äºç¡®å®šæ€§é€‰æ‹©ï¼ˆv4.0å‚æ•°åŒ–æ¨¡å¼ï¼‰

**Environmentçš„å®é™…åšæ³•**ï¼š
- ç”¨åŸå§‹å€¼ï¼ˆæœªå½’ä¸€åŒ–ï¼‰
- è‡ªå·±é‡æ–°è®¾è®¡äº†æƒé‡ï¼ˆä½†ä¸æ¸…æ™°ï¼‰
- é€‚ç”¨äºRLæ¢ç´¢å­¦ä¹ 

**çŸ›ç›¾**ï¼š
ä¸¤å¥—ç³»ç»Ÿå…±å­˜ä½†ä¸åè°ƒï¼Œé€ æˆconfusionã€‚

---

### é—®é¢˜5ï¼šCooperationæœºåˆ¶å½¢åŒè™šè®¾ âš ï¸

**é—®é¢˜æè¿°**ï¼š
```python
cooperation_bonus = 0.2 * (other_buildings * 0.05 + spatial * 0.02)
                  = 0.01 ~ 0.2  # æœ€å¤§å€¼0.2

base_reward = 162  # æ•°é‡çº§ï¼šç™¾
```

**å æ¯”åˆ†æ**ï¼š
- cooperation_bonus / base_reward = 0.2 / 162 = **0.12%**
- åœ¨total_rewardçš„noiseèŒƒå›´å†…ï¼Œå‡ ä¹ä¸å¯å­¦ä¹ 

**è®¾è®¡vsç°å®**ï¼š
| å‚æ•° | è®¾è®¡æ„å›¾ | å®é™…æ•ˆæœ |
|------|---------|---------|
| `cooperation_lambda=0.2` | åä½œå 20%æƒé‡ | å®é™…<0.2% |
| åŠŸèƒ½äº’è¡¥å¥–åŠ± | é¼“åŠ±ä¸¤agentåä½œ | ä¿¡å·å¤ªå¼± |
| ç©ºé—´åè°ƒå¥–åŠ± | é¼“åŠ±åˆç†å¸ƒå±€ | ä¿¡å·å¤ªå¼± |

**å½±å“**ï¼š
- RLæ— æ³•å­¦ä¹ åˆ°åä½œç­–ç•¥
- ä¸¤ä¸ªagentå®é™…ä¸Šæ˜¯ç‹¬ç«‹å†³ç­–
- Multi-Agentçš„ä¼˜åŠ¿æœªä½“ç°

---

### é—®é¢˜6ï¼šç§Ÿé‡‘æœºåˆ¶çš„è®¾è®¡ç¼ºé™· âš ï¸âš ï¸

**é—®é¢˜æè¿°**ï¼š
ä»£ç ä¸­å­˜åœ¨ç§Ÿé‡‘è®¾è®¡ï¼Œä½†å®ç°æœ‰è¯¯ï¼š

```python
# EDUçš„reward
rev_land = Rent[size]  # EDUè·å¾—ç§Ÿé‡‘æ”¶å…¥ï¼ˆ25/45/70ï¼‰

# INDçš„reward
rev = ... - Rent[size]  # INDæ”¯ä»˜ç§Ÿé‡‘ï¼ˆ-25/-45/-70ï¼‰
```

**çœ‹èµ·æ¥åƒ**ï¼šINDä»˜ç§Ÿé‡‘ â†’ EDUæ”¶ç§Ÿé‡‘

**å®é™…ä¸Š**ï¼š
- EDUçš„`Rent[size]`æ˜¯**EDUè‡ªå·±å»ºç­‘çš„åœ°ç§Ÿæ”¶å…¥**
- INDçš„`-Rent[size]`æ˜¯**INDè‡ªå·±å»ºç­‘çš„åœ°ç§Ÿæ”¯å‡º**
- **ä¸¤è€…æ²¡æœ‰ä»»ä½•è”ç³»ï¼**

**æ­£ç¡®çš„ç§Ÿé‡‘æœºåˆ¶åº”è¯¥æ˜¯**ï¼š
```python
# EDUåº”è¯¥ä»æ‰€æœ‰INDå»ºç­‘æ”¶ç§Ÿ
total_ind_rent = sum([Rent[b.size] for b in industrial_buildings])
edu_reward += total_ind_rent

# INDæ”¯ä»˜ç§Ÿé‡‘ç»™EDU
ind_reward -= Rent[size]
```

**å½“å‰çš„è¯¯å¯¼**ï¼š
- çœ‹èµ·æ¥æœ‰agenté—´ç»æµå…³ç³»
- å®é™…ä¸Šä¸¤ä¸ªagentå®Œå…¨ç‹¬ç«‹
- è¿™æ˜¯"å‡çš„Multi-Agentå…³ç³»"

---

### é—®é¢˜7ï¼šBudgetç³»ç»Ÿçš„ç»æµé€»è¾‘é—®é¢˜ âš ï¸

**é—®é¢˜åœºæ™¯**ï¼š
```
åˆå§‹é¢„ç®—ï¼š15000
å»ºé€ 10ä¸ªSå‹å»ºç­‘ï¼š

Month 0: 
  - cost: -2000, reward: +162 â†’ budget = 13162 (å‡€-1838)
Month 1:
  - cost: -2000, reward: +162 â†’ budget = 11324 (å‡€-1838)
...
Month 8:
  - cost: -2000, reward: +162 â†’ budget = -290 (ç ´äº§ï¼)
```

**é—®é¢˜åˆ†æ**ï¼š

1. **åªè®¡å…¥ä¸€æ¬¡rewardä¸åˆç†**
   - ç°å®ï¼šå»ºç­‘å»ºæˆåï¼Œ**æ¯ä¸ªæœˆéƒ½äº§ç”Ÿæ”¶ç›Š**
   - å½“å‰ï¼šå»ºç­‘åªåœ¨å»ºé€ æœˆäº§ç”Ÿä¸€æ¬¡reward
   - å¯¼è‡´ï¼šæ— æ³•å›æœ¬ï¼Œå¿…ç„¶ç ´äº§

2. **æœˆåº¦æ”¶ç›Šåº”è¯¥ç´¯ç§¯**
   ```python
   # åº”è¯¥æ˜¯
   month_1_income = building_1.reward
   month_2_income = building_1.reward + building_2.reward
   month_3_income = building_1.reward + building_2.reward + building_3.reward
   ...
   ```

3. **Budgetå˜æˆäº†"ç°é‡‘æµ"è€Œé"å‡€èµ„äº§"**
   - Budgetç³»ç»Ÿæ¨¡æ‹Ÿçš„æ˜¯ç°é‡‘æµï¼ˆæ¯æœˆæ”¶æ”¯ï¼‰
   - ä½†æ²¡æœ‰è€ƒè™‘èµ„äº§ä»·å€¼ï¼ˆå·²å»ºå»ºç­‘çš„ä»·å€¼ï¼‰
   - å®é™…ä¸Šåº”è¯¥ï¼š`net_worth = budget + Î£(building_value)`

---

## å…·ä½“æ¡ˆä¾‹åˆ†æ

### æ¡ˆä¾‹1ï¼šSå‹ vs Lå‹çš„é€‰æ‹©

**åœºæ™¯**ï¼šzone=near, LP_norm=0.8, budget=15000

| æŒ‡æ ‡ | Så‹å»ºç­‘ | Lå‹å»ºç­‘ |
|------|---------|---------|
| **Cost** | 1010 | 2510 |
| **Reward** | 162 | 276 |
| **å›æœ¬å‘¨æœŸ** | 6.2ä¸ªæœˆ | 9.1ä¸ªæœˆ |
| **20ä¸ªæœˆæ€»æ”¶ç›Š** | 162*20 - 1010 = 2230 | 276*20 - 2510 = 3010 |
| **RLçš„total_reward** | 162 + 2 + ... = 166 | 276 + 2 + ... = 280 |
| **Budgetå½±å“** | -1010 + 162 = -848 | -2510 + 276 = -2234 |

**åˆ†æ**ï¼š
- **é•¿æœŸæ¥çœ‹**ï¼šLå‹æ›´ä¼˜ï¼ˆæ€»æ”¶ç›Š3010 > 2230ï¼‰
- **RLè§†è§’**ï¼šLå‹ç•¥ä¼˜ï¼ˆ280 > 166ï¼‰
- **Budgetè§†è§’**ï¼šSå‹ä¼˜ï¼ˆ-848 > -2234ï¼Œæ¶ˆè€—æ›´å°‘ï¼‰
- **ç ´äº§é£é™©**ï¼šLå‹æ›´é«˜ï¼ˆéœ€è¦æ›´å¤šåˆå§‹èµ„æœ¬ï¼‰

**RLä¼šå­¦åˆ°ä»€ä¹ˆ**ï¼š
- åœ¨budgetå……è¶³æ—¶ï¼šå¯èƒ½é€‰Lå‹ï¼ˆrewardæ›´é«˜ï¼‰
- åœ¨budgetç´§å¼ æ—¶ï¼šè¢«è¿«é€‰Så‹ï¼ˆé¿å…ç ´äº§æƒ©ç½šï¼‰
- å®é™…è§‚å¯Ÿï¼š**100% Så‹** â†’ è¯´æ˜budgetæƒ©ç½šä¸»å¯¼äº†å†³ç­–

---

### æ¡ˆä¾‹2ï¼šæœ€è¿‘ä¸€æ¬¡è®­ç»ƒçš„å¤±è´¥åˆ†æ

**è®­ç»ƒç»“æœ**ï¼š
```
Episode Returns: -82 åˆ° -89ï¼ˆå…¨è´Ÿï¼ï¼‰
IND Budget: 15000 â†’ -10332
EDU Budget: 10000 â†’ -12168
```

**åŸå› æ¨æ–­**ï¼š

1. **Size Bonusè®¾ç½®é”™è¯¯**
   ```
   æˆ‘ä¹‹å‰é”™è¯¯è®¡ç®—ï¼š
   - å‡è®¾cost = 100/300/600ï¼ˆé”™ï¼å®é™…æ˜¯900/1500/2400ï¼‰
   - è®¾ç½®size_bonus = {M: 1000, L: 2750}
   - å¯¼è‡´ï¼šå³ä½¿åŠ äº†bonusï¼Œrewardä»ç„¶è¿œå°äºcost
   ```

2. **æ¯ä¸ªåŠ¨ä½œéƒ½äºæŸ**
   ```
   Så‹ï¼šreward=162+0, cost=1010 â†’ net=-848
   Må‹ï¼šreward=210+1000=1210, cost=1500 â†’ net=-290
   Lå‹ï¼šreward=276+2750=3026, cost=2400 â†’ net=+626
   
   ä½†å®é™…ä¸Šè¿˜æœ‰proximity_reward=1500é™åˆ°400ï¼š
   å®é™…total_reward â‰ˆ 60-90ï¼ˆè¿œä½äºé¢„æœŸï¼‰
   ```

3. **è¿é”å´©æºƒ**
   ```
   æ¯ä¸ªåŠ¨ä½œ â†’ budgetå‡å°‘ â†’ budget_penaltyå¢åŠ  â†’ total_rewardå˜è´Ÿ
   â†’ PPOå­¦åˆ°"å»ºç­‘=æƒ©ç½š" â†’ ä¸‹æ¬¡æ›´ä¿å®ˆ â†’ æ¶æ€§å¾ªç¯
   ```

---

## æ€»ç»“

### å½“å‰ç³»ç»Ÿçš„å®é™…è¡¨ç°

| æ–¹é¢ | è®¾è®¡ç›®æ ‡ | å®é™…æ•ˆæœ | ç¬¦åˆåº¦ |
|------|---------|---------|-------|
| **Cost-Rewardå¹³è¡¡** | é•¿æœŸæ”¶ç›Šæƒè¡¡ | Budgetä¸»å¯¼ï¼ŒçŸ­æœŸæ€ç»´ | âš ï¸ 20% |
| **Multi-Agentåä½œ** | ä¸¤agentäº’ä¾äº’è¡¥ | å®Œå…¨ç‹¬ç«‹å†³ç­– | âš ï¸ 5% |
| **ç§Ÿé‡‘æœºåˆ¶** | INDå‘EDUäº¤ç§Ÿ | ä¸¤è€…æ— å…³è” | âŒ 0% |
| **Sizeå¤šæ ·æ€§** | S/M/Léƒ½æœ‰ä»·å€¼ | 100% Så‹ | âŒ 0% |
| **ç»æµå¯æŒç»­æ€§** | ç›ˆåˆ©å¯æŒç»­ | å¿…ç„¶ç ´äº§ | âŒ 0% |

### æ ¸å¿ƒé—®é¢˜ä¼˜å…ˆçº§

1. **ğŸ”´ ç´§æ€¥**ï¼šBudgetçš„ç»æµé€»è¾‘é”™è¯¯
   - å¯¼è‡´trainingå¿…ç„¶å¤±è´¥
   - éœ€è¦ç«‹å³ä¿®å¤

2. **ğŸŸ  é‡è¦**ï¼šCost/Rewardæ—¶é—´ç»´åº¦ä¸ä¸€è‡´
   - è¯¯å¯¼RLå­¦ä¹ 
   - å½±å“ç­–ç•¥è´¨é‡

3. **ğŸŸ¡ ä¸­ç­‰**ï¼šCooperationæœºåˆ¶å¤ªå¼±
   - æ— æ³•ä½“ç°Multi-Agentä¼˜åŠ¿
   - ä½†ä¸å½±å“åŸºæœ¬è®­ç»ƒ

4. **ğŸŸ¢ æ¬¡è¦**ï¼šç§Ÿé‡‘æœºåˆ¶è®¾è®¡ç¼ºé™·
   - å½“å‰å½±å“æœ‰é™
   - å¯ä»¥ä½œä¸ºfuture work

---

## å»ºè®®çš„ä¿®å¤æ–¹å‘

### çŸ­æœŸä¿®å¤ï¼ˆè®©è®­ç»ƒèƒ½è·‘èµ·æ¥ï¼‰

1. **å›æ»šBudgeté…ç½®**
   - æ¢å¤`proximity_reward=1500`ï¼ˆä»400å›åˆ°1500ï¼‰
   - å‡å°æˆ–ç§»é™¤`size_bonus`ï¼ˆå½“å‰å€¼è¿‡å¤§ï¼‰
   - ç¡®ä¿å¤§éƒ¨åˆ†åŠ¨ä½œçš„`total_reward > 0`

2. **ç®€åŒ–Rewardè®¡ç®—**
   - åªç”¨`base_reward = action.reward`
   - ç§»é™¤é‡å¤çš„`quality_reward`
   - ä¿æŒBudgetä½œä¸ºè½¯çº¦æŸ

### ä¸­æœŸä¼˜åŒ–ï¼ˆæå‡è®­ç»ƒè´¨é‡ï¼‰

1. **ä¿®æ­£Budgeté€»è¾‘**
   - å°†costè§†ä¸ºèµ„äº§æŠ•èµ„ï¼Œä¸æ˜¯çº¯æ”¯å‡º
   - æ¯æœˆç´¯ç§¯æ‰€æœ‰å»ºç­‘çš„reward
   - Budget = åˆå§‹èµ„é‡‘ + Î£(æ¯æœˆæ€»æ”¶ç›Š) - Î£(å†å²æ€»æŠ•èµ„)

2. **å¼ºåŒ–Cooperation**
   - æé«˜`cooperation_lambda`åˆ°1.0-2.0
   - å®ç°çœŸæ­£çš„ç§Ÿé‡‘è½¬ç§»æœºåˆ¶
   - å¢åŠ agenté—´çš„rewardä¼ é€’

### é•¿æœŸé‡æ„ï¼ˆç†æƒ³è®¾è®¡ï¼‰

1. **ç»Ÿä¸€Cost/Rewardä½“ç³»**
   - ç”¨NPVç»Ÿä¸€è¯„ä¼°
   - æˆ–è€…åˆ†ç¦»"ç»æµä»·å€¼"å’Œ"ç­–ç•¥ä»·å€¼"

2. **çœŸæ­£çš„Multi-Agent**
   - ç‹¬ç«‹çš„Actor/Criticç½‘ç»œ
   - é€šä¿¡æœºåˆ¶
   - è”åˆç›®æ ‡å‡½æ•°

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**åˆ›å»ºæ—¶é—´**ï¼š2025-10-11  
**çŠ¶æ€**ï¼šå¾…è®¨è®º

