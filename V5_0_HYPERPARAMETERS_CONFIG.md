# v5.0 超参数配置详解

## 🎯 超参数配置位置

### **配置文件位置**
```json
"mappo": {
  "ppo": {
    "clip_eps": 0.15,        // PPO裁剪参数
    "gamma": 0.99,          // 折扣因子
    "gae_lambda": 0.8,      // GAE参数
    "entropy_coef": 0.01,   // 熵系数
    "value_coef": 0.5,      // 价值函数系数
    "target_kl": 0.02,      // 目标KL散度
    "max_grad_norm": 0.5,   // 梯度裁剪
    "lr": 3e-4,             // 学习率
    "lr_schedule": "cosine"  // 学习率调度
  }
}
```

## 📊 超参数对比分析

### **v4.1 vs v5.0 超参数对比**

| 参数 | v4.1 | v5.0 | 说明 |
|------|------|------|------|
| **clip_eps** | 0.15 | 0.15 | PPO裁剪参数，控制策略更新幅度 |
| **gamma** | 0.99 | 0.99 | 折扣因子，影响未来奖励权重 |
| **gae_lambda** | 0.8 | 0.8 | GAE参数，控制优势估计 |
| **entropy_coef** | 0.01 | 0.01 | 熵系数，鼓励探索 |
| **value_coef** | 0.1 | 0.5 | 价值函数损失权重 |
| **target_kl** | ❌ 无 | 0.02 | 目标KL散度，控制策略更新 |
| **max_grad_norm** | ❌ 无 | 0.5 | 梯度裁剪，防止梯度爆炸 |
| **lr** | 0.0003 | 3e-4 | 学习率 |
| **lr_schedule** | ❌ 无 | cosine | 学习率调度策略 |

## 🔧 超参数详细说明

### **1. PPO核心参数**

#### **clip_eps (裁剪参数)**
```json
"clip_eps": 0.15
```
- **作用**: 控制策略更新的幅度
- **范围**: 0.1-0.3
- **推荐值**: 0.15 (平衡稳定性和学习速度)

#### **target_kl (目标KL散度)**
```json
"target_kl": 0.02
```
- **作用**: 控制策略更新的KL散度阈值
- **范围**: 0.01-0.05
- **推荐值**: 0.02 (防止策略更新过大)

### **2. 奖励相关参数**

#### **gamma (折扣因子)**
```json
"gamma": 0.99
```
- **作用**: 控制未来奖励的权重
- **范围**: 0.9-0.999
- **推荐值**: 0.99 (长期规划)

#### **gae_lambda (GAE参数)**
```json
"gae_lambda": 0.8
```
- **作用**: 控制优势估计的偏差-方差权衡
- **范围**: 0.8-0.95
- **推荐值**: 0.8 (平衡估计质量)

### **3. 损失函数参数**

#### **entropy_coef (熵系数)**
```json
"entropy_coef": 0.01
```
- **作用**: 鼓励探索，防止策略过早收敛
- **范围**: 0.001-0.1
- **推荐值**: 0.01 (平衡探索和利用)

#### **value_coef (价值函数系数)**
```json
"value_coef": 0.5
```
- **作用**: 控制价值函数损失的权重
- **范围**: 0.1-1.0
- **推荐值**: 0.5 (平衡策略和价值函数)

### **4. 优化参数**

#### **lr (学习率)**
```json
"lr": 3e-4
```
- **作用**: 控制参数更新步长
- **范围**: 1e-5 - 1e-3
- **推荐值**: 3e-4 (平衡收敛速度和稳定性)

#### **max_grad_norm (梯度裁剪)**
```json
"max_grad_norm": 0.5
```
- **作用**: 防止梯度爆炸
- **范围**: 0.1-1.0
- **推荐值**: 0.5 (稳定训练)

#### **lr_schedule (学习率调度)**
```json
"lr_schedule": "cosine"
```
- **作用**: 动态调整学习率
- **选项**: "cosine", "linear", "constant"
- **推荐值**: "cosine" (平滑衰减)

## 🎯 超参数调优建议

### **1. 开发测试阶段**
```json
"ppo": {
  "clip_eps": 0.2,        // 较大裁剪，快速学习
  "target_kl": 0.05,      // 较大KL，允许更大更新
  "entropy_coef": 0.02,   // 更多探索
  "lr": 5e-4              // 较高学习率
}
```

### **2. 功能验证阶段**
```json
"ppo": {
  "clip_eps": 0.15,       // 标准裁剪
  "target_kl": 0.02,      // 标准KL
  "entropy_coef": 0.01,   // 标准探索
  "lr": 3e-4              // 标准学习率
}
```

### **3. 正式训练阶段**
```json
"ppo": {
  "clip_eps": 0.1,        // 较小裁剪，稳定训练
  "target_kl": 0.01,      // 较小KL，精细更新
  "entropy_coef": 0.005,  // 较少探索
  "lr": 1e-4              // 较低学习率
}
```

### **4. 生产环境**
```json
"ppo": {
  "clip_eps": 0.1,        // 保守裁剪
  "target_kl": 0.01,      // 保守KL
  "entropy_coef": 0.001,  // 最少探索
  "lr": 1e-5              // 很低学习率
}
```

## 🔍 超参数监控

### **1. 训练监控指标**
- **KL散度**: 监控策略更新幅度
- **裁剪率**: 监控裁剪频率
- **熵值**: 监控探索程度
- **梯度范数**: 监控梯度大小

### **2. 性能指标**
- **收敛速度**: 达到目标性能的步数
- **最终性能**: 训练结束时的性能
- **稳定性**: 训练过程中的性能波动

## 📈 超参数调优流程

### **1. 基线配置**
```json
"ppo": {
  "clip_eps": 0.15,
  "target_kl": 0.02,
  "entropy_coef": 0.01,
  "value_coef": 0.5,
  "lr": 3e-4
}
```

### **2. 单参数调优**
- 固定其他参数，调整一个参数
- 记录性能变化
- 选择最佳值

### **3. 多参数组合**
- 基于单参数结果
- 尝试参数组合
- 验证最终性能

### **4. 交叉验证**
- 多次运行验证
- 统计显著性测试
- 选择稳定配置

## 🎯 推荐配置

### **通用配置**
```json
"ppo": {
  "clip_eps": 0.15,
  "gamma": 0.99,
  "gae_lambda": 0.8,
  "entropy_coef": 0.01,
  "value_coef": 0.5,
  "target_kl": 0.02,
  "max_grad_norm": 0.5,
  "lr": 3e-4,
  "lr_schedule": "cosine"
}
```

### **高性能配置**
```json
"ppo": {
  "clip_eps": 0.1,
  "gamma": 0.99,
  "gae_lambda": 0.9,
  "entropy_coef": 0.005,
  "value_coef": 0.3,
  "target_kl": 0.01,
  "max_grad_norm": 0.3,
  "lr": 1e-4,
  "lr_schedule": "cosine"
}
```

## 📝 总结

v5.0系统的超参数配置非常完善：

- ✅ **完整配置**: 包含所有PPO核心参数
- ✅ **灵活调整**: 支持各种超参数组合
- ✅ **监控支持**: 提供详细的训练监控
- ✅ **调优建议**: 针对不同场景的配置建议

**推荐从基线配置开始，根据训练效果逐步调优！** 🚀
