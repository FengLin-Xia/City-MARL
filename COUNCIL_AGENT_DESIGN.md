# Council智能体设计文档

## 概述

Council智能体是专门负责A/B/C尺寸教育建筑的新智能体，与EDU智能体并行执行，解决A/B/C建筑对岸放置问题。

## 基础规则

### 1. 候选槽位规则
- **选择集基于当前两侧的候选范围**
- **如果没有候选槽位，跳过本次放置**
- 不强制放置，遵循自然的选择逻辑
- **building_level=3过滤**：只考虑 `building_level=3` 的槽位，避免与IND抢占M/L槽位
- **延迟启动**：第6个月开始执行，前5个月跳过

### 2. 智能体职责分离
- **EDU智能体**：负责S/M/L尺寸教育建筑
- **Council智能体**：负责A/B/C尺寸教育建筑  
- **IND智能体**：保持不变

## 核心特性

### 1. 河流过滤
- **EDU**：S/M/L受河流连通域过滤限制
- **Council**：A/B/C完全绕过河流过滤，可跨河放置
- **IND**：保持原有河流过滤逻辑

### 2. 邻近性约束
- **EDU**：与现有EDU建筑保持邻近性
- **Council**：独立邻近性策略
  - 可选择：与EDU hub邻近性
  - 可选择：与现有A/B/C建筑邻近性
  - 可选择：完全独立放置

### 3. 奖励系统
- **EDU**：保持现有奖励结构
- **Council**：专门的对岸放置奖励系统
  - 对岸放置奖励
  - 与EDU建筑协同奖励
  - 独立目标函数

## 实现架构

### 1. 配置系统
```json
{
  "agents": ["IND", "EDU", "Council"],
  "council": {
    "enabled": true,
    "river_bypass": true,
    "proximity_strategy": "independent",
    "skip_if_no_candidates": true,
    "reward_weights": {
      "other_side_bonus": 100.0,
      "edu_synergy": 50.0
    }
  }
}
```

### 2. 动作池生成
```python
# 当前逻辑
sizes={'EDU': ['S', 'M', 'L', 'A', 'B', 'C'], 'IND': ['S', 'M', 'L']}

# 新逻辑  
sizes={'EDU': ['S', 'M', 'L'], 'Council': ['A', 'B', 'C'], 'IND': ['S', 'M', 'L']}
```

### 3. 环境逻辑
- `_get_candidate_slots()`区分EDU和Council
- 河流过滤针对不同智能体
- 邻近性约束分别处理

## 协调机制

### 1. 槽位占用
- 共享槽位占用信息
- 避免重复放置
- 优先级机制（Council优先？）

### 2. 资源分配
- 预算系统协调
- 避免资源冲突
- 平衡不同智能体需求

## 训练策略

### 1. 多智能体训练
- 3个智能体并行训练
- 独立学习率设置
- 协调奖励设计

### 2. 探索策略
- Council专门的对岸探索
- 课程学习机制
- 强制探索与自然探索平衡

## 实现步骤

### 第一阶段：基础框架
1. 添加Council智能体到配置
2. 修改动作池生成逻辑
3. 实现基础的候选槽位获取

### 第二阶段：河流过滤
1. 实现Council的河流过滤绕过
2. 测试对岸槽位获取
3. 验证距离约束

### 第三阶段：奖励系统
1. 设计Council的奖励函数
2. 实现对岸放置奖励
3. 测试奖励效果

### 第四阶段：协调优化
1. 实现智能体协调机制
2. 优化训练策略
3. 性能调优

## 预期效果

### 1. 解决核心问题
- A/B/C建筑成功对岸放置
- 保持EDU正常行为
- 逻辑清晰分离

### 2. 系统优势
- 职责明确分离
- 灵活的策略配置
- 易于调试优化
- 良好的扩展性

## 风险评估

### 1. 技术风险
- 多智能体训练复杂度增加
- 协调机制可能产生冲突
- 收敛难度可能增加

### 2. 设计风险
- Council奖励函数设计困难
- 与EDU的协同关系复杂
- 性能可能下降

### 3. 缓解措施
- 渐进式实现
- 充分的测试验证
- 回滚机制准备

## 下一步行动

1. **确认设计方向**：是否按此思路继续
2. **选择实现起点**：从哪个模块开始
3. **制定详细计划**：具体的实现步骤
4. **开始编码实现**：逐步构建系统

---

*文档创建时间：2024年*
*版本：v1.0*
*状态：设计阶段*
