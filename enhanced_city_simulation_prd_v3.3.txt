1. é¡¹ç›®æ¦‚è¿°
1.1 é¡¹ç›®åç§°

å¢å¼ºåŸå¸‚æ¨¡æ‹Ÿç³»ç»Ÿï¼ˆEnhanced City Simulation Systemï¼‰

1.2 é¡¹ç›®ç›®æ ‡

æ„å»ºåŸºäºå¤šæ™ºèƒ½ä½“çš„åŸå¸‚å‘å±•æ¨¡æ‹Ÿç³»ç»Ÿï¼Œé€šè¿‡é«˜æ–¯æ ¸åœ°ä»·æ½œåŠ›åœºã€ç»Ÿä¸€æŠ•æ ‡å†³ç­–ã€çœŸå®é€šå‹¤è½¨è¿¹ä¸å¤šæ—¶é—´å°ºåº¦æ›´æ–°ï¼Œå‘ˆç°é€å±‚â€œæ¶Ÿæ¼ªå¼â€ç”Ÿé•¿ï¼šå†…å±‚æ»¡æ ¼ â†’ å¤–å±‚è§£é”ã€‚

1.3 æ ¸å¿ƒç‰¹æ€§

è½»é‡å¤šæ™ºèƒ½ä½“ï¼ˆæ”¿åºœ/ä¼ä¸š/å±…æ°‘ï¼‰ååŒä½†ç»Ÿä¸€å†³ç­–å™¨è½åœ°

åœ°ä»·åœºé©±åŠ¨çš„é€‰å€ä¸æ²¿ä¸»å¹²é“é¦–å‘

æ—¶é—´åˆ†å±‚ï¼šæ…¢ï¼ˆåœ°ä»·/è®¾æ–½ï¼‰ï½œä¸­ï¼ˆäººå£/éœ€æ±‚ï¼‰ï½œå¿«ï¼ˆå»ºç­‘ï¼‰

å†»ç»“æ–½å·¥çº¿ä¸ä¸¥æ ¼é€å±‚å¤–æ‰©

ä½å®…â†’å•†ä¸šæ»åæ›¿ä»£ï¼ˆHysteresisï¼‰

å…¬å…±ç”¨åœ°å¼ºåˆ¶ä»‹å…¥ï¼ˆå­¦æ ¡/åŒ»é™¢/å…¬å›­/å¹¿åœºï¼‰

è½¨è¿¹çƒ­åŠ›ä¸å¯è§†åŒ–ï¼ˆç­‰å€¼çº¿/æ§½ä½/å±‚è¿›åº¦ï¼‰

1.4 ä¸€å¥è¯æ¶æ„

æ”¿åºœå®šéª¨æ¶ï¼šä¸€æ¡ä¸»èµ°å»Šå¸¦ + ä¸¤ä¸ªé¡¶ç‚¹ï¼ˆHub1=å•†ä¸š/å®¢è¿æ ¸ï¼ŒHub2=å·¥ä¸š/è´§è¿æ ¸ï¼‰ã€‚
å…ˆå¸¦åç‚¹ã€å…ˆå†…åå¤–ï¼šé¦–å­£æ²¿èµ°å»Šä¸¤ä¾§â€œè¡—å¢™â€æ’æ»¡ï¼Œå†ç”±åŒé¡¶ç‚¹å‘å¤–æ”¾å°„æ‰©å¼ ï¼Œå±‚å±‚è§£é”ã€‚
ç»Ÿä¸€å†³ç­–ï¼šåŒä¸€å¥—æ§½ä½ï¼Œå•†ä¸š/ä½å®…/å·¥ä¸šåœ¨åŒä¸€å†³ç­–å™¨ä¸‹æŒ‰åˆ†æ•°æŠ•æ ‡ï¼Œä¸­æ ‡è½ä½ï¼ˆå—é…é¢ä¸åˆ†åŒºï¼‰ã€‚

2. ç³»ç»Ÿæ¶æ„
2.1 æ•´ä½“æ¶æ„
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   é…ç½®ç³»ç»Ÿ      â”‚    â”‚   é€»è¾‘ç³»ç»Ÿ      â”‚    â”‚   å¯è§†åŒ–ç³»ç»Ÿ    â”‚
â”‚  - åŸå¸‚é…ç½®     â”‚    â”‚  - åœ°ä»·åœºç³»ç»Ÿ   â”‚    â”‚  - æ¸²æŸ“å¼•æ“     â”‚
â”‚  - å»ºç­‘é…ç½®     â”‚    â”‚  - æ™ºèƒ½ä½“ç³»ç»Ÿ   â”‚    â”‚  - åŠ¨ç”»ç³»ç»Ÿ     â”‚
â”‚  - æ™ºèƒ½ä½“é…ç½®   â”‚    â”‚  - è½¨è¿¹ç³»ç»Ÿ     â”‚    â”‚  - çƒ­åŠ›å›¾æ˜¾ç¤º   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   æ•°æ®ç³»ç»Ÿ      â”‚
                    â”‚  - çŠ¶æ€ç®¡ç†     â”‚
                    â”‚  - è¾“å‡ºç³»ç»Ÿ     â”‚
                    â”‚  - ç»Ÿè®¡ç³»ç»Ÿ     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2.2 æ¨¡å—åˆ’åˆ†

é…ç½®æ¨¡å—ï¼ˆconfigs/ï¼‰ï¼šåŸå¸‚/å»ºç­‘/æ™ºèƒ½ä½“/è¯„åˆ†/åœ°ä»·/å±‚è§„åˆ™

é€»è¾‘æ¨¡å—ï¼ˆlogic/ï¼‰ï¼šåœ°ä»·åœºã€ç­‰å€¼çº¿ã€å†³ç­–å™¨ã€æ™ºèƒ½ä½“ã€è½¨è¿¹ã€æ›¿ä»£ã€å…¬å»º

å¯è§†åŒ–æ¨¡å—ï¼ˆviz/ï¼‰ï¼šåœ°ä»·/çƒ­åŠ›/ç­‰å€¼çº¿/æ§½ä½/å±‚è¿›åº¦/åŠ¨ç”»

æ•°æ®æ¨¡å—ï¼ˆçŠ¶æ€ã€è¾“å‡ºã€é‡å»ºï¼‰

2.3 æ”¿åºœéª¨æ¶ç³»ç»Ÿ

èµ°å»Šå¸¦ï¼ˆæ¡å¸¦ï¼‰ï¼šä¸»å¹²é“ä¸­å¿ƒçº¿ Î“ï¼›å‚æ•°ï¼šsetback_mã€sigma_perpã€‚
Road-L0 é¦–å‘å¸ƒç½®å±‚ï¼šæ²¿ Î“ ä¸¤ä¾§åç§»çº¿ LÂ± ç­‰å¼§é•¿é‡‡æ ·ä¸ºæ§½ä½ï¼ˆå•†ä¸š 25â€“35mã€ä½å®… 30â€“45mã€å·¥ä¸š 35â€“55mï¼‰ï¼Œå†»ç»“ä¸º layer=road_L0_*ã€‚
åŒé¡¶ç‚¹ï¼ˆä¸¤æ”¾å°„æºï¼‰ï¼šHub1ï¼ˆå•†ä¸š/å®¢è¿ï¼‰ã€Hub2ï¼ˆå·¥ä¸š/è´§è¿ï¼‰ï¼Œå„å‘å¼‚æ€§æ ¸ï¼ˆæ²¿èµ°å»Šæ–¹å‘æ›´é•¿ï¼‰ã€‚
åˆ†åŒºï¼ˆzoningï¼‰ï¼šHub1 åŠå¾„ä¼˜å…ˆå•†ä¸šã€Hub2 åŠå¾„ä¼˜å…ˆå·¥ä¸šï¼Œä¸­æ®µèµ°å»Šä¼˜å…ˆä½å®…ï¼ˆä¼˜å…ˆ=å…è®¸é›†/æƒé‡å€¾æ–œè€Œéç¡¬è¦†ç›–ï¼‰ã€‚
é…é¢ä¸çºªå¾‹ï¼šå­£åº¦é…é¢ï¼ˆquota_res/com/indï¼‰ï¼›å†…å±‚æ»¡æ ¼ï¼ˆå«æ­»æ§½å®¹å¿ï¼‰â†’ å¤–å±‚è§£é”ã€‚

3. æ•°æ®æ¨¡å‹
3.1 åŸå¸‚çŠ¶æ€ï¼ˆCity Stateï¼‰
{
  "simulation_info": {
    "current_month": 0, "current_quarter": 0, "current_year": 0
  },
  "land_price_field": [[...]],            // 0~1 è¿ç»­åœºï¼ˆåŠ æƒå’Œ + å½’ä¸€åŒ–ï¼‰
  "land_price_stats": { "min": 0.03, "max": 0.97, "avg": 0.41 },
  "buildings": {
    "public": [...], "residential": [...], "commercial": [...], "industrial": [...]
  },
  "residents": [...],
  "trajectory_system": {
    "commute_heatmap": [[...]], "commercial_heatmap": [[...]],
    "combined": [[...]], "decay_rate": 0.8
  },
  "layers": [
    {
      "layer_id": "road_L0_residential", "layer_type": "road",
      "status": "active", "activated_quarter": 0,
      "capacity": 120, "dead_slots": 4, "capacity_effective": 116,
      "placed": 110, "density": 0.948,
      "slots": [{ "pos":[120,52], "used":true, "dead":false,
                  "allowed_types":["residential"] }]
    }
  ],
  "backbone_info": {
    "road_corridor": {"polyline":[[x,y],...]},
    "hub_commercial": [x,y],
    "hub_industrial": [x,y]
  },
  "hysteresis_flags": { /* ä½æ”¹å•†å€™é€‰ä¸å†·å´ */ },
  "public_facilities": [ /* è®¾æ–½+æœåŠ¡åŠå¾„ */ ]
}

3.2 é”®åä¸å•ä½çº¦æŸï¼ˆå¼ºåˆ¶ï¼‰

ç”¨åœ°é”®åç»Ÿä¸€é•¿åï¼š"commercial" | "industrial" | "residential"

å•ä½ç»Ÿä¸€ï¼šç©ºé—´è¾“å…¥ä»¥åƒç´ å­˜å‚¨ã€ä»¥ meters_per_pixel è½¬æ¢æ¯”è¾ƒï¼ˆåŠå¾„ã€é—´è·ç­‰éƒ½ä»¥â€œç±³â€ä¸ºå‡†ï¼‰

4. åŠŸèƒ½æ¨¡å—
4.1 æ—¶é—´ç³»ç»Ÿ

åœ°ä»·åœºæ›´æ–°ï¼šå¹´åº¦ï¼ˆæˆ–åŠå¹´ï¼‰ã€Ïƒ æ¸è¿›å¢é•¿ï¼ˆæŒ‡æ•°è¶‹ç¨³ï¼‰

å»ºç­‘æ›´æ–°ï¼šå­£åº¦æ‰¹é‡ï¼ˆä½å®… 10â€“20ã€å•†ä¸š 5â€“12ã€å·¥ä¸š 4â€“10ã€å…¬å…± 1â€“3ï¼‰

äººå£/çƒ­åŠ›ï¼šæœˆåº¦ï¼Œçƒ­åŠ› 20% è¡°å‡

æ¯æœˆï¼šå±…æ°‘è½¨è¿¹â†’çƒ­åŠ›ï¼ˆf_heatï¼‰â†’è®¾æ–½å¯è¾¾ä¿®æ­£ï¼ˆf_accessï¼‰
æ¯å­£ï¼šè‹¥æœ‰å¾…æ¿€æ´»å±‚â†’ä»¥â€œå½“å‰åœ°ä»·â€æå–ç­‰å€¼çº¿â†’å†»ç»“æ–½å·¥çº¿ä¸æ§½ä½â†’ç»Ÿä¸€æŠ•æ ‡å†³ç­–è½ä½
æ¯å¹´ï¼šåœ°ä»·åœºæ¼”åŒ–ï¼ˆÏƒ_hub/Ïƒ_road å¢é•¿ï¼‰ï¼Œå¹¶å½±å“æœªæ¥å°†æ¿€æ´»çš„å¤–å±‚

4.1.1 ç‰¹å¾ä¸è¯„åˆ†ç³»ç»Ÿï¼ˆv3.3 æ ¸å¿ƒä¿®å¤ï¼‰

æ§½ä½ç‰¹å¾ï¼ˆfeaturesï¼‰ï¼š

f_priceï¼šåœ°ä»·ï¼ˆä» land_price_field[y,x] ç›´æ¥è¯»å–ï¼Œ0~1ï¼‰å¿…é€‰

f_roadï¼šåˆ°èµ°å»Šçº¿ Î“ çš„æ³•å‘æ ¸ exp(-dâŠ¥Â²/2ÏƒâŠ¥Â²)

f_hub_comï¼šå•†ä¸šé¡¶ç‚¹æ ¸ï¼ˆå„å‘å¼‚æ€§é«˜æ–¯ï¼Œæ²¿çº¿æ›´é•¿ï¼‰

f_hub_indï¼šå·¥ä¸šé¡¶ç‚¹æ ¸ï¼ˆå„å‘å¼‚æ€§æˆ–å·®åˆ†ï¼Œé¿å¼€å•†ä¸šçƒ­ç‚¹ï¼‰

f_accessï¼šå…¬å…±è®¾æ–½å¯è¾¾ï¼ˆæœåŠ¡åŠå¾„å†…æŒ‰ 1âˆ’d/r è¡°å‡å–æœ€å¤§ï¼‰

f_heatï¼šå±…æ°‘çƒ­åŠ›ï¼ˆè¿‘é‚»å¯†åº¦æŒ‡æ•°è¡°å‡ï¼‰

crowding / junction_penaltyï¼šæ‹¥æŒ¤/è·¯å£æƒ©ç½š

ç»Ÿä¸€æ‰“åˆ†å‡½æ•°ï¼ˆåŒå½¢ä¸åŒæƒï¼›æ–°å¢ f_price å¹¶å…¥ï¼‰ï¼š

å•†ä¸š
score_com = 0.35*f_price + 0.25*f_hub_com + 0.20*f_road + 0.15*f_heat + 0.05*f_access - 0.03*crowding - 0.02*junction

å·¥ä¸š
score_ind = (-0.20)*f_price + 0.45*f_hub_ind + 0.25*f_road + 0.05*f_access - 0.10*crowding - 0.05*junction

ä½å®…
score_res = 0.10*f_price + 0.45*f_road + 0.15*f_access - 0.15*f_hub_com - 0.10*f_hub_ind - 0.05*crowding

æƒé‡å¯é…ç½®ï¼›æ–¹å‘æ€§å»ºè®®ï¼šå•†ä¸šåå¥½é«˜ä»·ï¼Œå·¥ä¸šåå¥½ä½ä»·ï¼Œä½å®…å±…ä¸­ä¸”åâ€œé è·¯+è®¾æ–½â€ã€‚

4.2 è½¨è¿¹ç³»ç»Ÿ

æ—¥ç¨‹ï¼šä½å®…â†’å·¥ä½œâ†’è´­ç‰©â†’ä½å®…

çƒ­åŠ›ï¼šæ¯æ¬¡ç§»åŠ¨ç´¯ç§¯ï¼Œæœˆåº¦è¡°å‡ 20%ï¼Œè¾“å‡ºé€šå‹¤/å•†ä¸š/ç»¼åˆçƒ­åŠ›å±‚

å¯¹è¯„åˆ†çš„ä½œç”¨ï¼šè¿›å…¥ f_heatï¼ˆå•†ä¸šå¯¹äººæµæ•æ„Ÿã€ä½å®…æ¬¡ä¹‹ã€å·¥ä¸šå¼±ï¼‰

4.3 æ™ºèƒ½ä½“ç³»ç»Ÿï¼ˆè½»é‡èšåˆï¼Œç»Ÿä¸€å†³ç­–å™¨è½åœ°ï¼‰

æ”¿åºœï¼ˆPolicyï¼‰ï¼šéª¨æ¶/åˆ†åŒº/é…é¢/å…¬å…±ç”¨åœ° â†’ å½±å“å…è®¸é›†ä¸æ•°é‡

ä¼ä¸šï¼ˆSupplyï¼‰ï¼šæŒ‰ç±»å‹å¯¹æ¿€æ´»å±‚æ§½ä½æŠ•æ ‡ï¼ˆç”±è¯„åˆ†ç³»ç»Ÿè®¡ç®—ï¼‰ï¼›ä¸ç›´æ¥è½ä½

å±…æ°‘ï¼ˆDemandï¼‰ï¼šæä¾›ä½å®…éœ€æ±‚/æ¶ˆè´¹å¼ºåº¦ï¼Œå½±å“é…é¢ä¸çƒ­åŠ›

4.4 é«˜æ–¯æ ¸åœ°ä»·æ½œåŠ›åœºç³»ç»Ÿï¼ˆv3.3 ä¿®è®¢ï¼‰

æ ¸å‡½æ•°

ç‚¹æ ¸ï¼ˆæ¢çº½ï¼‰ï¼šH_c, H_i ä¸º 2D/å„å‘å¼‚æ€§é«˜æ–¯

çº¿æ ¸ï¼ˆé“è·¯ï¼‰ï¼šR = exp(-dâŠ¥Â²/2Ïƒ_roadÂ²)ï¼ˆå¯åŠ æ²¿çº¿è¡°å‡å˜â€œç®¡çŠ¶æ ¸â€ï¼‰

èµ°å»Šæ ¸ï¼ˆå¯é€‰ï¼‰ï¼šCï¼ˆtanh/é«˜æ–¯å‹ï¼‰ï¼Œç”¨äºé”å®šèµ°å»Šéª¨æ¶ï¼ˆä¸ç ´åè¿ç»­æ€§ï¼‰

èåˆï¼ˆå¼ƒç”¨ maxï¼Œé‡‡ç”¨åŠ æƒå’Œ+å½’ä¸€åŒ–ï¼‰

ğ‘ƒ
base
(
ğ‘¥
)
=
ğ‘¤
ğ‘Ÿ
ğ‘…
+
ğ‘¤
ğ‘
ğ»
ğ‘
+
ğ‘¤
ğ‘–
ğ»
ğ‘–
+
ğ‘¤
ğ‘
ğ‘œ
ğ‘Ÿ
ğ¶
+
ğ‘
0
P
base
	â€‹

(x)=w
r
	â€‹

R+w
c
	â€‹

H
c
	â€‹

+w
i
	â€‹

H
i
	â€‹

+w
cor
	â€‹

C+b
0
	â€‹

ğ‘™
ğ‘
ğ‘›
ğ‘‘
_
ğ‘
ğ‘Ÿ
ğ‘–
ğ‘
ğ‘’
_
ğ‘“
ğ‘–
ğ‘’
ğ‘™
ğ‘‘
=
c
l
i
p
(
ğ‘ƒ
base
âˆ’
ğ‘
ğ‘š
ğ‘–
ğ‘›
ğ‘
ğ‘š
ğ‘
ğ‘¥
âˆ’
ğ‘
ğ‘š
ğ‘–
ğ‘›
,
â€‰
0
,
â€‰
1
)
land_price_field=clip(
p
max
	â€‹

âˆ’p
min
	â€‹

P
base
	â€‹

âˆ’p
min
	â€‹

	â€‹

,0,1)

å¯é€‰è½¯é˜ˆï¼šå¯¹ land_price_field åº”ç”¨ smoothstep(Ï„)ï¼Œç¦æ­¢ç¡¬é˜ˆç½® 0ï¼Œé¿å…å¹³å°ä¸æ–­è£‚ã€‚

æ—¶é—´æ¼”åŒ–ï¼šÏƒ_hub, Ïƒ_road æŒ‰ Ïƒ(t)=Ïƒ_baseÂ·(1+(Mâˆ’1)(1âˆ’e^{âˆ’gÂ·t})) æ¸è¿›å¢é•¿ï¼›å½±å“æœªæ¥å°†æ¿€æ´»çš„å±‚ã€‚

å•ä½ä¸€è‡´æ€§ï¼šå…¨éƒ¨è·ç¦»ä»¥â€œç±³â€è®¡ç®—ï¼Œåƒç´ Ã—meters_per_pixel è½¬æ¢ã€‚

4.5 å»ºç­‘å¢é•¿ç³»ç»Ÿï¼ˆé€å±‚ä¸¥æ ¼ç”Ÿé•¿ï¼‰

å†»ç»“æ–½å·¥çº¿ï¼šå±‚æ¿€æ´»æ—¶ï¼Œä»å½“å‰ land_price_field å–å¯¹åº”ç”¨é€”çš„ç­‰å€¼çº¿ â†’ å†»ç»“ polyline + æ§½ä½

é€å±‚è§„åˆ™ï¼šdensity = placed / capacity_effective

density â‰¥ 95%ï¼ˆæˆ–æ­»æ§½å®¹å¿åç­‰æ•ˆ 100%ï¼‰â†’ æ ‡è®° complete

ä»…å½“æ‰€æœ‰å†…å±‚ complete â†’ å¤–å±‚æ–¹å¯æ¿€æ´»

é…é¢ç»“è½¬ï¼šå½“å­£å‰©ä½™é…é¢ä¸è·¨å±‚ä½¿ç”¨ï¼›å¯é…ç½®ç»“è½¬åˆ°ä¸‹å­£åŒå±‚

4.6 åˆ†å¸¦ä¸ç­‰å€¼çº¿å»ºç­‘ç”Ÿæˆï¼ˆv3.3 å¯¹é½åœ°ä»·ï¼‰

åˆ†å¸¦è§„åˆ™ï¼ˆæ³•å‘è·ä¸»å¹²é“ï¼‰

å‰æ’ï¼ˆ60â€“120mï¼‰ï¼šä»…å•†ä¸š

ä½å®…å¸¦ï¼ˆ120â€“260mï¼‰ï¼šä½å®…ä¸ºä¸»ï¼ˆå¯å…è®¸å°‘é‡å•†ä¸šï¼‰

å¤–å›´ï¼ˆ>260mï¼‰ï¼šæ··åˆ

ç­‰å€¼çº¿æ¥æºä¸å†»ç»“ï¼ˆå…³é”®ä¿®è®¢ï¼‰

å•†ä¸šï¼šä» land_price_field å– é«˜å€¼é˜ˆåˆ— P = 0.85 â†’ 0.78 â†’ 0.71 â†’ â€¦

å·¥ä¸šï¼šå– å¤–ä¾§ä¼˜å…ˆæˆ–å†…ä¾§ä¼˜å…ˆ çš„åºåˆ—ï¼ˆç¤ºä¾‹ï¼š0.60 â†’ 0.70 â†’ 0.80 â†’ â€¦ è¡¨ç¤ºè¶Šå¤–è¶Šä¼˜ï¼‰

ä½å®…ï¼šå–ç›®æ ‡å¸¦åŒºï¼ˆå¦‚ Pâˆˆ[0.45,0.65]ï¼‰çš„ä¸­å¿ƒç­‰å€¼çº¿æˆ–åŒç­‰å€¼å¸¦

åœ¨â€œå±‚æ¿€æ´»å½“å­£â€æå–å½“å‰åœ°ä»·ç­‰å€¼çº¿å¹¶å†»ç»“ï¼Œå‡ ä½•åç»­ä¸å˜

æ§½ä½åŒ–ï¼ˆslottingï¼‰

ç­‰å¼§é•¿é‡‡æ ·ï¼šå•†ä¸š 25â€“35mï¼Œä½å®… 35â€“55mï¼Œå·¥ä¸š 35â€“55m

æ³•å‘å¾®åç§»ï¼ˆâ‰¤1mï¼‰ã€åˆ‡å‘æŠ–åŠ¨ï¼ˆâ‰¤0.5mï¼‰

æ­»æ§½ï¼šè¢«è¾¹ç•Œ/å…¬å…±ç”¨åœ°/ç¢°æ’é®æŒ¡çš„æ§½ä½ï¼Œæ ‡ä¸º deadï¼Œä¸è®¡æœ‰æ•ˆå®¹é‡

4.7 ä½å®… â†’ å•†ä¸šæ›¿ä»£ï¼ˆHysteresisï¼‰

æ¡ä»¶ï¼šè¿ç»­ 2 å­£åº¦ score_com > score_res + 0.15

å†·å´æœŸï¼š4 å­£åº¦

ä¿åº•ï¼šä½å®…å æ¯” â‰¥ 35%

4.8 å…¬å…±ç”¨åœ°æœºåˆ¶

è§¦å‘ï¼šäººå£å¯†åº¦/å¯è¾¾æ€§/å»ºç­‘å¯†åº¦/å•†ä¸šå¯†åº¦é˜ˆå€¼

æ•ˆæœï¼šåŠå¾„å†… f_access æŠ¬å‡ï¼›å¯å¯¹ f_price è½»å¾®å¢ç›Šï¼ˆâ‰¤+10â€“20%ï¼‰

å…¬å…±ç”¨åœ°ä¸æ¶ˆè€—å•†ä½å·¥é…é¢ï¼Œä½†å¯å±è”½æ§½ä½ï¼ˆdeadï¼‰

4.9 ç”Ÿé•¿æµç¨‹ï¼ˆæ¡å¸¦â†’æ”¾å°„ï¼‰

Q0â€“Q1ï¼šæ²¿èµ°å»Šé¦–å‘ï¼ˆRoad-L0ï¼‰

æ¿€æ´»å¹¶å†»ç»“ road_L0_com/res/indï¼ˆä¸¤ä¾§â€œè¡—å¢™â€ä½ï¼‰

åªåœ¨ road_L0_* æŠ•æ”¾ï¼›æ»¡æ ¼ï¼ˆâ‰¥95%ï¼‰ åæ ‡è®° complete

æœŸé—´å¯æ’å…¥å…¬å…±ç”¨åœ°åˆ·æ–° f_access

Q2+ï¼šåŒé¡¶ç‚¹æ”¾å°„ + èµ°å»Šå¤–æ‰©

å½“å­£**ä»…åœ¨â€œå½“å‰æœ€å†…ä¾§ active å±‚â€**ä¸­æ ‡ï¼›å±‚æ»¡â†’ä¸‹å­£æ¿€æ´»ä¸‹ä¸€åœˆ

æ¿€æ´»æ—¶ä»¥å½“å‰åœ°ä»·æå–ç­‰å€¼çº¿å¹¶å†»ç»“

è§†è§‰ï¼šä¸€æ¡â€œè¡—å¢™â€ â†’ ä¸¤ç«¯æ”¾å°„çŠ¶å¤–æ‰© â†’ ä¸­æ®µå¹³è¡Œå¸¦å¤–æ¶¨

4.10 å†³ç­–å™¨ï¼ˆç»Ÿä¸€ä¸­æ ‡ï¼›é•¿åé”®ï¼‰

ä¼ªä»£ç ï¼ˆv3.3 ä¿®è®¢ï¼Œå« f_priceï¼‰ï¼š

def place_on_active_layer(active_layer, quotas, city_state):
    buckets = {"commercial": [], "residential": [], "industrial": []}
    for slot in active_layer.free_slots():
        feats = compute_features(slot)  # åŒ…å« f_price
        scores = {
          "commercial":  dot(W_com, feats) if slot.allow("commercial")  else -inf,
          "residential": dot(W_res, feats) if slot.allow("residential") else -inf,
          "industrial":  dot(W_ind, feats) if slot.allow("industrial")  else -inf
        }
        winner = argmax(scores)
        if winner: buckets[winner].append((slot, scores[winner]))

    placed = []
    for k in ["commercial","residential","industrial"]:
        take = topN(buckets[k], quotas[k])   # é…é¢è£å‰ª
        placed += place_with_collision_check(take)

    if active_layer.effective_density() >= 0.95:  # æ­»æ§½å®¹å¿
        active_layer.complete()
        schedule_activate_next_layer()  # ä¸‹å­£ç”Ÿæ•ˆ
    return placed

5. å¯è§†åŒ–ç³»ç»Ÿ

é¡ºåºï¼šç½‘æ ¼ â†’ çƒ­åŠ› â†’ é“è·¯/æ¢çº½ â†’ åœ°ä»·ç­‰å€¼çº¿ â†’ å†»ç»“çš„æ–½å·¥çº¿ â†’ æ§½ä½ â†’ å»ºç­‘ â†’ å±…æ°‘ â†’ ç»Ÿè®¡

æ§½ä½æ€ï¼šFree=ç©ºå¿ƒåœ†ï¼›Used=å®å¿ƒåœ†ï¼›Dead=ç°å‰

å±‚æ€ï¼šActive=é«˜äº®ç²—çº¿ï¼›Complete=ç»¿è‰²å‹¾

é¢æ¿ï¼šæ¯å±‚è¿›åº¦ã€dead æ§½ä½æ•°ã€å½“å­£é…é¢/è½ä½æ•°

åŠ¨ç”»ï¼šæ–°å»ºç­‘ä»æ§½ä½ 0.6s ç”Ÿé•¿æˆ footprint

6. è¾“å‡ºç³»ç»Ÿ
6.1 å¢é‡å¯¼å‡ºï¼ˆä¸é‡å»ºï¼‰

æœˆ 0ï¼šå®Œæ•´çŠ¶æ€ building_positions_month_00.json

æœˆ 1â€¦Nï¼šåªå¯¼å¢é‡ building_delta_month_MM.json

æä¾› get_full_state_at_month(M) é‡å»ºï¼ˆå«ç¼“å­˜ï¼‰

6.2 å…¶ä»–è¾“å‡º

city_state_output.jsonã€trajectory_data.json

land_price_evolution.jsonã€land_price_field_quarterly.json

facility_events.jsonã€conversion_events.json

layer_state_quarterly.jsonï¼ˆå±‚/æ§½ä½çŠ¶æ€ï¼‰

simplified_buildings_MM.json/txtï¼ˆAPI å‹å¥½çš„æ‰å¹³æ ¼å¼ï¼‰

æ¸²æŸ“å¸§ï¼šmonth_MM.pngã€city_evolution.gif

7. é…ç½®ç³»ç»Ÿï¼ˆç¤ºä¾‹ï¼Œä¸é”®å/å•ä½å¯¹é½ï¼‰
"city": {
  "map_size": [110, 110],
  "meters_per_pixel": 2.0,
  "trunk_road": [[20,55],[90,55]],
  "transport_hubs": [[20,55],[90,55]]
},
"government_backbone": {
  "road_corridor": { "sigma_perp_m": 40,
    "setback_m": { "commercial": 8, "residential": 10, "industrial": 14 } },
  "hubs": {
    "commercial": { "sigma_perp_m": 30, "sigma_parallel_m": 90 },
    "industrial": { "sigma_perp_m": 35, "sigma_parallel_m": 110 }
  },
  "zoning": {
    "hub_com_radius_m": 350, "hub_ind_radius_m": 450,
    "mid_corridor_residential": true
  },
  "quotas_per_quarter": {
    "residential": [10,20], "commercial": [5,12], "industrial": [4,10]
  },
  "strict_layering": true, "dead_slots_ratio_max": 0.05
},
"gaussian_land_price_system": {
  "w_r": 0.6, "w_c": 0.5, "w_i": 0.5, "w_cor": 0.2, "bias": 0.0,
  "hub_sigma_base_m": 40, "road_sigma_base_m": 20,
  "hub_growth_rate": 0.03, "road_growth_rate": 0.02,
  "max_hub_multiplier": 2.0, "max_road_multiplier": 2.5,
  "normalize": true, "smoothstep_tau": 0.0
},
"scoring_weights": {
  "commercial":  { "f_price": 0.35, "f_hub_com": 0.25, "f_road": 0.20,
                   "f_heat": 0.15, "f_access": 0.05,
                   "crowding": -0.03, "junction_penalty": -0.02 },
  "industrial":  { "f_price": -0.20, "f_hub_ind": 0.45, "f_road": 0.25,
                   "f_access": 0.05, "crowding": -0.10, "junction_penalty": -0.05 },
  "residential": { "f_price": 0.10, "f_road": 0.45, "f_access": 0.15,
                   "f_hub_com": -0.15, "f_hub_ind": -0.10, "crowding": -0.05 }
},
"isocontour_layout": {
  "commercial":  { "levels": [0.85, 0.78, 0.71], "arc_spacing_m": [25,35] },
  "industrial":  { "levels": [0.60, 0.70, 0.80], "arc_spacing_m": [35,55] },
  "residential": { "band": [0.45, 0.65], "arc_spacing_m": [35,55] },
  "normal_offset_m": 1.0, "jitter_m": 0.5,
  "fallback_percentiles": { "enabled": true,
    "commercial": [95,90,85], "residential": [80,70,60,50], "industrial": [70,60,50] }
},
"progressive_growth": {
  "enabled": true,
  "strict_fill_required": true,
  "allow_dead_slots_ratio": 0.05,
  "carry_over_quota": false,
  "freeze_contour_on_activation": true
},
"landuse_hysteresis": { "delta_bid": 0.15, "L_quarters": 2,
  "cooldown_quarters": 4, "res_min_share": 0.35 },
"public_facility_rules": {
  "school":  { "trigger_population": 500, "service_radius": 500, "symbol": "ğŸ«" },
  "hospital":{ "trigger_distance_threshold": 800, "service_radius": 800, "symbol": "ğŸ¥" },
  "park":    { "trigger_building_density": 0.6, "service_radius": 300, "symbol": "ğŸŒ³" },
  "plaza":   { "trigger_commercial_density": 0.5, "service_radius": 400, "symbol": "ğŸ›ï¸" }
}

8. éªŒæ”¶æ ‡å‡†ï¼ˆv3.3 å£å¾„ï¼‰
ä¸»æ ‡å‡†

åœ°ä»·ä¸€è‡´æ€§ï¼šè½ä½æ—¶ f_price çš„åˆ†å¸ƒä¸å»ºç­‘ç”¨é€”ä¸€è‡´ï¼›

ç»Ÿè®¡å£å¾„ï¼šä»¥æ§½ä½ä¸ºæ ·æœ¬ï¼Œè®¡ç®—â€œä¸­æ ‡æ¦‚ç‡ vs f_priceâ€çš„ Spearman ç›¸å…³ï¼›å•†ä¸š/ä½å®…/å·¥ä¸šç»¼åˆç›¸å…³ â‰¥ 0.7

ç­‰å€¼çº¿ä¸€è‡´æ€§ï¼šæ¯å±‚çš„å†»ç»“æ–½å·¥çº¿ä¸æ¿€æ´»å½“å­£çš„ land_price_field ç­‰å€¼çº¿è¯¯å·® â‰¤ 0.5m

å‡ ä½•ç­‰è·ï¼šå•†ä¸šç­‰å€¼çº¿å¹³å‡æ³•å‘é—´è· = 30m Â±10%ï¼›ä½å®… = 40m Â±10%

ç­‰å¼§é•¿é‡‡æ ·ï¼šæ²¿å•æ¡ç­‰å€¼çº¿ç›¸é‚»å»ºç­‘é—´è·è½åœ¨é…ç½®åŒºé—´çš„å æ¯” â‰¥ 90%

åˆ†å¸¦æ­£ç¡®ï¼šå‰æ’æ— ä½å®…ï¼›ä½å®…ä¸»è¦è½åœ¨å¸¦åŒº

æ—¶é—´ç§©åºï¼šcomplete_at(road_L0) â‰¤ activated_at(P0_c/P0_i)

é€å±‚ä¸¥æ ¼æ€§ï¼šä»»æ„å­£åº¦ï¼Œè‹¥å­˜åœ¨å¤–å±‚ active/usedï¼Œåˆ™æ‰€æœ‰å†…å±‚å¿…é¡» completeï¼›å±‚ densityï¼ˆè€ƒè™‘ dead æ§½ï¼‰=100% æ–¹å¯æ¿€æ´»å¤–å±‚

å¯è§†åŒ–ä¸æ—¥å¿—

é¢æ¿æ˜¾ç¤ºï¼šæ¯å±‚è¿›åº¦æ¡ã€dead æ§½ä½æ•°ã€å½“å­£é…é¢ä¸è½ä½æ•°

å†³ç­–æ—¥å¿—ï¼šæ¯ä¸ªæ§½ä½ä¿å­˜ features/scores/winnerï¼ˆæ”¯æŒå®¡è®¡ï¼‰

9. å¼€å‘è®¡åˆ’ï¼ˆå¯¹é½ v3.3ï¼‰

é˜¶æ®µ1ï¼šåœ°ä»·èåˆæ”¹é€ ï¼ˆåŠ æƒå’Œ+å½’ä¸€åŒ–+è½¯é˜ˆï¼Œç§»é™¤ max/ç¡¬æˆªæ–­ï¼‰â€”â€”1 å¤©

é˜¶æ®µ2ï¼šè¯„åˆ†ç³»ç»Ÿå¹¶å…¥ f_priceï¼Œé…ç½®ä¸é”®åç»Ÿä¸€ï¼ˆcommercial/industrial/residentialï¼‰â€”â€”0.5 å¤©

é˜¶æ®µ3ï¼šå¤–å±‚æ¿€æ´»=å½“å‰åœ°ä»·å–ç­‰å€¼çº¿å¹¶å†»ç»“ï¼ˆå•†ä¸š/å·¥ä¸š/ä½å®…ä¸‰é€šé“ï¼‰â€”â€”1 å¤©

é˜¶æ®µ4ï¼šåˆ†åŒº/åŠå¾„å•ä½ç»Ÿä¸€ï¼ˆç±³â†”åƒç´ ï¼‰ ä¸ Road-L0 æ²¿çº¿ç­‰å¼§é•¿é‡‡æ ·â€”â€”1 å¤©

é˜¶æ®µ5ï¼šå¯è§†åŒ–ä¸éªŒæ”¶ç»Ÿè®¡ï¼ˆç›¸å…³æ€§ã€è¯¯å·®é‡æµ‹ã€å®¡è®¡ï¼‰â€”â€”1 å¤©

é˜¶æ®µ6ï¼šæµ‹è¯•ä¸ä¼˜åŒ–â€”â€”1 å¤©

10. é£é™©è¯„ä¼°ä¸ç¼“è§£

ç­‰å€¼çº¿æŠ–åŠ¨ï¼šÏƒ å¢é•¿è¿‡å¿« â†’ Î± æŒ‡æ•°å¹³æ»‘ + â€œæ¿€æ´»æ—¶å†»ç»“â€

å±‚å¡æ­»ï¼ˆæ­»æ§½è¿‡å¤šï¼‰ï¼šallow_dead_slots_ratio å®¹å¿ï¼›å¿…è¦æ—¶å›é€€åˆ°æ¬¡çº§ç­‰å€¼çº¿/åˆ†ä½æ•°

å¤–å±‚æ¿€æ´»è¿‡è¿Ÿï¼šè®¾ç½® max_quarters_per_layer æˆ–æœ€ä½å¯†åº¦é˜ˆâ€œè½¯è§£é”â€ï¼ˆå¯é€‰ï¼‰

å…¬å…±ç”¨åœ°è¿‡å¯†ï¼šè®¾æ–½æœ€å°é—´è·ä¸ä¼˜å…ˆçº§é˜Ÿåˆ—

é”®å/å•ä½é”™é…ï¼šåœ¨ CI åŠ  é…ç½®/å•ä½/é”®åä¸€è‡´æ€§æ ¡éªŒ

ç›¸å…³æ€§ä¸è¶³ï¼šè°ƒå¤§ w_price_comã€æ”¶ç´§ f_roadï¼Œå¹¶æ£€æŸ¥èµ°å»Šæ ¸ C çš„æƒé‡ä¸ä¼šå‹å¹³æ¢¯åº¦

11. ç‰ˆæœ¬å†å²

v3.3ï¼ˆå½“å‰ï¼‰

åœ°ä»·åœºå‚ä¸è½ä½å†³ç­–ï¼ˆæ–°å¢ f_priceï¼‰

èåˆæ”¹â€œåŠ æƒå’Œ+å½’ä¸€åŒ–ï¼ˆå¯é€‰è½¯é˜ˆï¼‰â€ï¼Œå¼ƒç”¨ max/ç¡¬æˆªæ–­

å¤–å±‚æ¿€æ´» = å½“å‰åœ°ä»·æå–å¹¶å†»ç»“ï¼Œæ—¶é—´æ¼”åŒ–å¯¹â€œæœªæ¥å±‚â€ç”Ÿæ•ˆ

Road-L0 æ”¹æ²¿çº¿ç­‰å¼§é•¿é‡‡æ ·ï¼›é”®å/å•ä½/å°ºå¯¸å…¨é¢ç»Ÿä¸€

éªŒæ”¶å£å¾„åŠ å…¥â€œåœ°ä»·ç›¸å…³æ€§ â‰¥ 0.7â€â€œå†»ç»“ç­‰å€¼çº¿è¯¯å·® â‰¤ 0.5mâ€

v3.2

æ”¿åºœéª¨æ¶ï¼šèµ°å»Šå¸¦ + åŒé¡¶ç‚¹ï¼›ç»Ÿä¸€å†³ç­–å™¨ï¼›æ§½ä½åŒ–ä¸ä¸¥æ ¼é€å±‚

v3.1

å†»ç»“æ–½å·¥çº¿ã€æ­»æ§½å®¹å¿ã€å±‚çŠ¶æ€æœºä¸è¿›åº¦å¯è§†åŒ–

v3.0

é«˜æ–¯æ ¸åœ°ä»·åœºæ›¿ä»£ SDFï¼›è¾“å‡º/é…ç½®ç»Ÿä¸€ä¸ºåœ°ä»·æœ¯è¯­

v2.3 åŠæ›´æ—©

æ—¶é—´åˆ†å±‚ã€åˆ†å¸¦é€»è¾‘ã€ä½æ”¹å•†æ»åã€è½¨è¿¹/çƒ­åŠ›

é™„ï¼šå®ç°è¦ç‚¹æ¸…å•ï¼ˆè½åœ°æ£€æŸ¥ï¼‰

 land_price_field ç”± w_r R + w_c H_c + w_i H_i (+ w_cor C) + b å½’ä¸€åŒ–å¾—åˆ°

 compute_features() å†™å…¥ f_price = land_price_field[y,x]ï¼ˆ0~1ï¼‰

 scoring_weights ä½¿ç”¨ é•¿åé”®ï¼ˆcommercial/industrial/residentialï¼‰

 åˆ†åŒºåŠå¾„æ¯”è¾ƒåœ¨â€œç±³ä¾§â€ï¼Œåƒç´ ä¹˜ meters_per_pixel

 å±‚æ¿€æ´»æ—¶å¯¹å½“å‰åœ°ä»·è¿è¡Œ marching squares â†’ å†»ç»“ polyline+slots

 Road-L0 æ²¿ä¸»å¹²é“ä¸¤ä¾§ç­‰å¼§é•¿é‡‡æ ·ï¼Œä¸åšé¢çŠ¶ç½‘æ ¼

 è¾“å‡º/æ—¥å¿—å« features/scores/winnerï¼Œç»Ÿè®¡ç›¸å…³æ€§ä¸å‡ ä½•è¯¯å·®