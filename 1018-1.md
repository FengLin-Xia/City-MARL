# 当前A/B/C配置处理记录 (2024-01-18)

## 概述
记录当前配置系统对A/B/C建筑的处理方式，为Council智能体设计提供参考。

## 当前智能体配置

### 1. 智能体列表
```json
"agents": [
  "IND",
  "EDU"
]
```
- 当前只有2个智能体：IND和EDU
- EDU负责所有教育建筑（S/M/L/A/B/C）
- 需要添加Council智能体专门负责A/B/C

### 2. 预算系统
```json
"budget_system": {
  "initial_budgets": {
    "IND": 15000,
    "EDU": 10000
  }
}
```
- 当前只有IND和EDU的预算
- 需要为Council添加独立预算

## A/B/C相关配置

### 1. 尺寸奖励 (size_bonus)
```json
"size_bonus": {
  "S": 0,
  "M": 0, 
  "L": 0,
  "A": 2550,
  "B": 3550,
  "C": 4050
}
```
- A/B/C有显著的高奖励
- S/M/L奖励为0
- 这些奖励将转移到Council智能体

### 2. 对岸奖励 (other_side_bonus_EDU_by_size)
```json
"other_side_bonus_EDU_by_size": { 
  "A": 70.0, 
  "B": 90.0, 
  "C": 110.0 
}
```
- 专门为A/B/C设计的对岸放置奖励
- 奖励强度：C > B > A
- 这些奖励将专门给Council智能体

### 3. 邻近性缩放 (proximity_scale_EDU_by_size)
```json
"proximity_scale_EDU_by_size": { 
  "A": 0.12, 
  "B": 0.10, 
  "C": 0.10 
}
```
- 大幅降低A/B/C的邻近性约束
- 让A/B/C更容易远离现有建筑
- Council智能体将使用这些设置

### 4. 邻近性约束特殊处理
```json
"proximity_constraint": {
  "edu_abcs_relax": true,
  "edu_abcs_max_distance": 45.0,
  "edu_abcs_skip": true
}
```
- `edu_abcs_relax`: 放宽A/B/C的邻近性约束
- `edu_abcs_max_distance`: 最大距离45.0
- `edu_abcs_skip`: 完全跳过A/B/C的邻近性检查

### 5. 动作枚举配置
```json
"caps": {
  "top_slots_per_agent_size": {
    "EDU": {
      "S": 150,
      "M": 150, 
      "L": 150,
      "A": 120,
      "B": 120,
      "C": 120
    }
  }
}
```
- A/B/C的槽位上限为120
- 比S/M/L的150稍低
- 这些配置将转移到Council

### 6. 序列长度
```json
"length_max": 3
```
- 最大动作序列长度为3
- 允许更长的建筑序列
- Council智能体将使用相同设置

## EDU对应配置处理

### 1. EDU智能体职责调整
- **当前**：EDU负责S/M/L/A/B/C所有教育建筑
- **调整后**：EDU只负责S/M/L，Council负责A/B/C

### 2. EDU配置清理
- 移除所有A/B/C相关的配置
- 保留S/M/L的配置
- 简化EDU的奖励系统

### 3. EDU邻近性约束
```json
"proximity_constraint": {
  "max_distance": 15.0,
  "apply_after_month": 0,
  "min_candidates": 5
}
```
- EDU的S/M/L保持正常邻近性约束
- 不受A/B/C特殊处理影响

## Council智能体配置设计

### 1. 基础配置
```json
"agents": [
  "IND",
  "EDU", 
  "Council"
]
```

### 2. 预算配置
```json
"budget_system": {
  "initial_budgets": {
    "IND": 15000,
    "EDU": 10000,
    "Council": 8000
  }
}
```

### 3. Council专用配置
```json
"council": {
  "enabled": true,
  "river_bypass": true,
  "proximity_strategy": "independent",
  "skip_if_no_candidates": true,
  "size_bonus": {
    "A": 2550,
    "B": 3550, 
    "C": 4050
  },
  "other_side_bonus": {
    "A": 70.0,
    "B": 90.0,
    "C": 110.0
  },
  "proximity_scale": {
    "A": 0.12,
    "B": 0.10,
    "C": 0.10
  }
}
```

## 迁移计划

### 1. 配置迁移
- 将A/B/C相关配置从EDU转移到Council
- 清理EDU配置，只保留S/M/L
- 添加Council专用配置

### 2. 代码迁移
- 修改动作枚举逻辑
- 更新河流过滤逻辑
- 调整奖励计算

### 3. 测试验证
- 确保EDU行为不受影响
- 验证Council的对岸放置
- 测试智能体协调

## 风险评估

### 1. 配置复杂性
- 当前配置已经相当复杂
- 添加Council会增加复杂度
- 需要仔细管理配置迁移

### 2. 向后兼容性
- 需要确保现有功能不受影响
- 可能需要分阶段迁移
- 准备回滚方案

### 3. 测试覆盖
- 需要全面测试新配置
- 验证所有功能正常
- 性能影响评估

---

*文档创建时间：2024-01-18*
*版本：v1.0*
*状态：设计阶段*
