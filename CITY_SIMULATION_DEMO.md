# 城市仿真Demo - 完整说明文档

## 🏙️ 项目概述

这是一个基于规则的城市仿真Demo，模拟了城市中政府、企业和居民的互动发展过程。通过智能体建模，展示了城市基础设施布局、居民移动模式和城市发展的动态演化。

### 🎯 核心特点
- **无强化学习**：纯规则驱动，逻辑清晰易懂
- **多智能体系统**：政府、企业、居民三类智能体
- **动态可视化**：实时热力图和动画播放
- **模块化设计**：易于扩展和修改

## 🏗️ 系统架构

### 文件结构
```
├── configs/
│   └── colors.json          # 颜色配置
├── data/
│   ├── poi.json            # 初始POI数据
│   └── poi_example.json    # 示例POI数据
├── logic/
│   ├── placement.py        # 政府和企业的POI布局逻辑
│   ├── schedule.py         # 居民日程安排逻辑
│   └── move.py            # 居民移动逻辑（直线/A*）
├── viz/
│   └── ide.py             # 可视化渲染引擎
├── main_demo.py           # 主仿真程序
├── view_results.py        # 结果查看工具
├── create_gif.py          # GIF生成工具
└── quick_test.py          # 快速测试脚本
```

### 核心模块

#### 1. 数据层 (`data/`)
- **POI数据**：存储城市中的兴趣点（学校、诊所、住宅、商业等）
- **颜色配置**：定义不同类型POI的显示颜色

#### 2. 逻辑层 (`logic/`)
- **布局逻辑**：政府和企业的POI放置策略
- **日程逻辑**：居民的日常活动安排
- **移动逻辑**：居民的路径规划和移动

#### 3. 可视化层 (`viz/`)
- **渲染引擎**：分层绘制热力图、POI、居民等
- **动画系统**：支持实时播放和GIF生成

## 🎮 智能体系统

### 1. 政府智能体 (蓝色系)
**职责**：提供公共服务设施
- **学校** (青色)：教育服务
- **诊所** (蓝色)：医疗服务  
- **公园** (绿色)：休闲服务

**决策规则**：
- 每天检查区域覆盖率
- 当平均到达时间 > 12分钟且覆盖率 < 80%时添加设施
- 优先在主干线附近20px范围内选址

### 2. 企业智能体 (橙色系)
**职责**：提供商业和居住服务
- **住宅** (黄色)：居住服务
- **零售** (橙色)：商业服务

**决策规则**：
- 监控设施使用率
- 当使用率 > 80%连续3天时扩容/复制
- 住宅：距主干线10-60px，靠近公共设施
- 零售：靠近枢纽200-400px或人流热点

### 3. 居民智能体 (白色点)
**职责**：在城市中移动和生活
- **日程**：家→工作→购物→家
- **移动**：支持直线插值和A*路径规划
- **热力**：移动时在热力图上留下痕迹

## ⏰ 时间系统

### 仿真参数
- **步长**：5-10分钟
- **每日步数**：144步（24小时）
- **仿真天数**：10天
- **每日新居民**：100人

### 居民日程
```
06:00-08:00  起床，从家出发
08:00-12:00  工作
12:00-13:00  午餐
13:00-17:00  工作
17:00-19:00  购物
19:00-06:00  回家休息
```

## 🎨 可视化系统

### 显示层次
1. **背景层**：主干线和枢纽
2. **热力层**：居民移动轨迹的热力分布
3. **POI层**：各类设施的位置和状态
4. **居民层**：当前移动的居民（白色点）

### 颜色编码
- **政府设施**：蓝色系列
- **企业设施**：橙色系列
- **居民**：白色动态点
- **热力图**：紫色渐变
- **新增POI**：红色边框高亮

### 动画功能
- **实时播放**：matplotlib窗口中的动画
- **GIF生成**：可分享的动画文件
- **多种模式**：完整动画、按天动画、快速预览

## 🚀 运行指南

### 1. 环境准备
```bash
# 安装依赖
pip install matplotlib pillow numpy

# 检查文件结构
ls configs/ data/ logic/ viz/
```

### 2. 运行仿真
```bash
# 运行完整仿真（10天）
python main_demo.py

# 快速测试（3天）
python quick_test.py
```

### 3. 查看结果
```bash
# 查看动画播放
python view_results.py

# 生成GIF文件
python create_gif.py
```

## 📊 观察要点

### 1. 热力走廊形成
- 观察居民移动路径的演化
- 识别主要交通走廊
- 发现人流热点区域

### 2. POI布局优化
- 政府设施的合理分布
- 企业设施的扩张模式
- 设施与需求的匹配度

### 3. 城市发展节奏
- 不同阶段的发展特点
- 设施饱和与扩容时机
- 城市形态的演化过程

## 🔧 自定义配置

### 修改仿真参数
在 `main_demo.py` 中调整：
```python
self.days = 10              # 仿真天数
self.steps_per_day = 144    # 每日步数
self.daily_residents = 100  # 每日新居民数
```

### 调整决策阈值
在 `logic/placement.py` 中修改：
```python
# 政府补点阈值
AVG_TIME_THRESHOLD = 12     # 平均时间阈值（分钟）
COVERAGE_THRESHOLD = 0.8    # 覆盖率阈值

# 企业扩容阈值
USAGE_RATIO_THRESHOLD = 0.8 # 使用率阈值
CONSECUTIVE_DAYS = 3        # 连续天数
```

### 自定义移动方式
在 `logic/move.py` 中切换：
```python
# 在main_demo.py中设置
self.movement_mode = "linear"  # 或 "astar"
```

## 🎯 验收标准

### 基础功能
- ✅ 居民按日程移动
- ✅ 热力图正确更新
- ✅ POI布局合理
- ✅ 可视化清晰

### 高级功能
- ✅ 政府智能补点
- ✅ 企业智能扩容
- ✅ 热力走廊形成
- ✅ 动画播放流畅

### 扩展性
- ✅ 模块化设计
- ✅ 参数可配置
- ✅ 易于扩展
- ✅ 文档完整

## 🔮 扩展方向

### 1. 智能体增强
- 添加更多类型的智能体
- 实现更复杂的决策逻辑
- 引入学习机制

### 2. 环境扩展
- 支持更复杂的地形
- 添加交通系统
- 实现多层级城市

### 3. 可视化增强
- 3D可视化
- 交互式界面
- 实时数据面板

### 4. 分析工具
- 统计分析
- 性能评估
- 对比实验

## 📝 技术细节

### 核心算法
- **A*路径规划**：简化的网格路径规划
- **热力计算**：基于移动轨迹的密度分布
- **POI选址**：基于距离和覆盖率的优化

### 性能优化
- **内存管理**：及时清理不需要的数据
- **渲染优化**：分层渲染减少重复计算
- **文件I/O**：批量处理提高效率

### 错误处理
- **数据验证**：检查输入数据的完整性
- **异常捕获**：优雅处理运行时错误
- **日志记录**：便于调试和监控

## 🎉 总结

这个城市仿真Demo展示了：
- **智能体建模**在城市规划中的应用
- **规则驱动**的仿真系统设计
- **可视化技术**在仿真中的重要性
- **模块化架构**的可扩展性

通过这个Demo，你可以：
- 理解城市发展的基本规律
- 学习智能体建模的方法
- 掌握仿真系统的设计思路
- 体验可视化技术的应用

这是一个完整、实用、可扩展的城市仿真系统！🏙️✨



