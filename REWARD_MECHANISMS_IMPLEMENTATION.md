# v5.0å¤æ‚å¥–åŠ±æœºåˆ¶å®ç°æ€»ç»“

## ğŸ“‹ å®ç°æ¦‚è¿°

æˆåŠŸåœ¨v5.0ä¸­å®ç°äº†å¤æ‚çš„å¥–åŠ±æœºåˆ¶ï¼ŒåŒ…æ‹¬12ä¸ªæ ¸å¿ƒå¥–åŠ±é¡¹ï¼Œå®Œå…¨éµå¾ªv5.0æ¶æ„åŸåˆ™ã€‚

## ğŸ¯ å·²å®ç°çš„å¥–åŠ±æœºåˆ¶

### 1. **NPVè®¡ç®—å¥–åŠ±** (`reward_terms/npv_reward.py`)
- **åŠŸèƒ½**: è®¡ç®—å‡€ç°å€¼ï¼Œè€ƒè™‘æœªæ¥æ”¶ç›Šçš„ç°å€¼
- **å…¬å¼**: `NPV = æœªæ¥æ”¶ç›Šç°å€¼ - å»ºé€ æˆæœ¬`
- **ç‰¹ç‚¹**: ä½¿ç”¨å¹´é‡‘ç°å€¼å…¬å¼ï¼Œæ”¯æŒæŠ˜ç°ç‡

### 2. **è¿›åº¦å¥–åŠ±** (`reward_terms/progress_reward.py`)
- **åŠŸèƒ½**: åŸºäºå·²æœ‰å»ºç­‘æ•°é‡ç»™äºˆå¥–åŠ±
- **å…¬å¼**: `è¿›åº¦å¥–åŠ± = å»ºç­‘æ•°é‡ Ã— å¥–åŠ±ç³»æ•°`
- **ç‰¹ç‚¹**: é¼“åŠ±æ™ºèƒ½ä½“å»ºé€ æ›´å¤šå»ºç­‘

### 3. **åä½œå¥–åŠ±** (`reward_terms/cooperation_reward.py`)
- **åŠŸèƒ½**: æ™ºèƒ½ä½“é—´åä½œå¥–åŠ±
- **åŒ…å«**: åŠŸèƒ½äº’è¡¥å¥–åŠ± + ç©ºé—´åè°ƒå¥–åŠ±
- **ç‰¹ç‚¹**: æ”¯æŒEDU-INDåè°ƒï¼Œç©ºé—´è·ç¦»ä¼˜åŒ–

### 4. **åœ°ä»·è´§å¸åŒ–** (`reward_terms/land_price_monetization.py`)
- **åŠŸèƒ½**: åœ°ä»·å¯¹æˆæœ¬/æ”¶ç›Šçš„å½±å“
- **è§„åˆ™**: EDUè·å¾—åœ°ä»·ï¼ŒINDæ”¯ä»˜åœ°ä»·
- **å…¬å¼**: `LP_value = LP_idx Ã— LandPriceBase`

### 5. **æ²³æµæº¢ä»·å¥–åŠ±** (`reward_terms/river_premium_reward.py`)
- **åŠŸèƒ½**: æ²³æµé™„è¿‘çš„æº¢ä»·å¥–åŠ±
- **å…¬å¼**: `æº¢ä»· = åŸºç¡€æ”¶ç›Š Ã— æº¢ä»·ç‡ Ã— è¡°å‡å› å­`
- **ç‰¹ç‚¹**: æ”¯æŒæŒ‡æ•°è¡°å‡ï¼Œè·ç¦»è¶Šè¿‘æº¢ä»·è¶Šé«˜

### 6. **è¿è¥æˆæœ¬** (`reward_terms/operational_costs.py`)
- **åŠŸèƒ½**: æœˆåº¦è¿è¥æˆæœ¬è®¡ç®—
- **ç‰¹ç‚¹**: ä¸åŒæ™ºèƒ½ä½“ã€ä¸åŒè§„æ¨¡çš„æˆæœ¬å·®å¼‚
- **å…¬å¼**: `è¿è¥æˆæœ¬ = -OPEX_rates[agent][size]`

### 7. **ç§Ÿé‡‘æ”¶å…¥** (`reward_terms/rental_income.py`)
- **åŠŸèƒ½**: EDUçš„ç§Ÿé‡‘æ”¶å…¥æœºåˆ¶
- **ç‰¹ç‚¹**: ä»…EDUè·å¾—ç§Ÿé‡‘æ”¶å…¥
- **å…¬å¼**: `ç§Ÿé‡‘æ”¶å…¥ = Rent_rates[size]`

### 8. **é‚»è¿‘æ€§å¥–åŠ±** (`reward_terms/proximity_reward.py`)
- **åŠŸèƒ½**: é‚»è¿‘æ€§å¥–åŠ±/æƒ©ç½šæœºåˆ¶
- **åŒ…å«**: é‚»è¿‘å¥–åŠ± + è·ç¦»æƒ©ç½š
- **ç‰¹ç‚¹**: è·ç¦»è¶Šè¿‘å¥–åŠ±è¶Šé«˜ï¼Œè·ç¦»è¶Šè¿œæƒ©ç½šè¶Šå¤§

### 9. **åŒºä½ä¹˜å­** (`reward_terms/zone_multipliers.py`)
- **åŠŸèƒ½**: åŒºä½å·®å¼‚å¯¹å¥–åŠ±çš„å½±å“
- **åŒ…å«**: åŒºä½ä¹˜å­ + ç›¸é‚»ä¹˜å­
- **ç‰¹ç‚¹**: æ”¯æŒnear/mid/faråŒºä½å·®å¼‚

### 10. **åœ°ä»·æ•æ„Ÿåº¦** (`reward_terms/land_price_sensitivity.py`)
- **åŠŸèƒ½**: åœ°ä»·å¯¹å¥–åŠ±çš„è°ƒèŠ‚
- **å…¬å¼**: `åœ°ä»·æ•æ„Ÿåº¦å¥–åŠ± = LP_idx Ã— LP_k`
- **ç‰¹ç‚¹**: åœ°ä»·è¶Šé«˜ï¼Œå¥–åŠ±è¶Šé«˜

### 11. **å»ºç­‘è§„æ¨¡å¥–åŠ±** (`reward_terms/building_size_bonus.py`)
- **åŠŸèƒ½**: å»ºç­‘è§„æ¨¡å¥–åŠ±ï¼Œé¼“åŠ±å»ºé€ M/Lå‹å»ºç­‘
- **å…¬å¼**: `è§„æ¨¡å¥–åŠ± = Size_bonus_rates[size] Ã— åŸºç¡€å€¼`
- **ç‰¹ç‚¹**: Så‹æ— å¥–åŠ±ï¼ŒM/Lå‹æœ‰å¥–åŠ±

### 12. **å¥–åŠ±ç¼©æ”¾** (`reward_terms/reward_scaling.py`)
- **åŠŸèƒ½**: å¥–åŠ±çš„ç¼©æ”¾å’Œè£å‰ª
- **å…¬å¼**: `ç¼©æ”¾å¥–åŠ± = åŸå§‹å¥–åŠ± / ç¼©æ”¾å› å­`
- **ç‰¹ç‚¹**: æ”¯æŒè£å‰ªåˆ°[-1, 1]èŒƒå›´

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### é…ç½®å±‚
- åœ¨`configs/city_config_v5_0.json`ä¸­æ·»åŠ äº†`reward_mechanisms`é…ç½®å—
- æ¯ä¸ªå¥–åŠ±é¡¹éƒ½æœ‰ç‹¬ç«‹çš„é…ç½®å‚æ•°
- æ”¯æŒå¯ç”¨/ç¦ç”¨æ§åˆ¶

### æ¨¡å—å±‚
- æ¯ä¸ªå¥–åŠ±é¡¹éƒ½æ˜¯ç‹¬ç«‹çš„æ¨¡å—
- å®ç°ç»Ÿä¸€çš„`compute(prev_state, state, action_id) -> float`æ¥å£
- æ”¯æŒé…ç½®é©±åŠ¨çš„å‚æ•°è°ƒæ•´

### ç®¡ç†å™¨
- `RewardManager`ç»Ÿä¸€ç®¡ç†æ‰€æœ‰å¥–åŠ±é¡¹
- æ”¯æŒæ€»å¥–åŠ±è®¡ç®—å’Œå¥–åŠ±åˆ†è§£
- æä¾›è°ƒè¯•ä¿¡æ¯è¾“å‡º

## ğŸ§ª æµ‹è¯•ç»“æœ

### æµ‹è¯•è¦†ç›–
- âœ… æ‰€æœ‰12ä¸ªå¥–åŠ±é¡¹éƒ½æ­£å¸¸å·¥ä½œ
- âœ… ä¸åŒåŠ¨ä½œIDçš„å¥–åŠ±è®¡ç®—æ­£ç¡®
- âœ… å¥–åŠ±åˆ†è§£åŠŸèƒ½æ­£å¸¸
- âœ… é…ç½®é©±åŠ¨æœºåˆ¶æ­£å¸¸

### æµ‹è¯•è¾“å‡ºç¤ºä¾‹
```
åŠ¨ä½œ 0: æ€»å¥–åŠ± = 1590.193
  npv: 168.122
  progress: 0.500
  land_price_monetization: 550.000
  river_premium: 11.237
  operational_costs: -70.000
  rental_income: 25.000
  proximity: 900.000
  land_price_sensitivity: 5.000
  reward_scaling: 0.333
```

## ğŸ”§ é…ç½®ç¤ºä¾‹

```json
"reward_mechanisms": {
  "npv_calculation": {
    "enabled": true,
    "expected_lifetime": 12,
    "discount_rate": 0.05
  },
  "progress_reward": {
    "enabled": true,
    "building_count_multiplier": 0.5
  },
  "cooperation_reward": {
    "enabled": true,
    "lambda": 0.1
  }
}
```

## ğŸš€ ä½¿ç”¨æ–¹å¼

```python
from reward_terms.reward_manager import RewardManager

# åˆ›å»ºå¥–åŠ±ç®¡ç†å™¨
reward_manager = RewardManager(config)

# è®¡ç®—æ€»å¥–åŠ±
total_reward = reward_manager.compute_total_reward(prev_state, state, action_id)

# è·å–å¥–åŠ±åˆ†è§£
breakdown = reward_manager.get_reward_breakdown(prev_state, state, action_id)
```

## ğŸ“ˆ æ€§èƒ½ç‰¹ç‚¹

- **æ¨¡å—åŒ–**: æ¯ä¸ªå¥–åŠ±é¡¹ç‹¬ç«‹ï¼Œæ˜“äºç»´æŠ¤
- **å¯é…ç½®**: æ‰€æœ‰å‚æ•°éƒ½å¯é€šè¿‡é…ç½®è°ƒæ•´
- **å¯æ‰©å±•**: æ˜“äºæ·»åŠ æ–°çš„å¥–åŠ±é¡¹
- **é«˜æ•ˆ**: åªè®¡ç®—å¯ç”¨çš„å¥–åŠ±é¡¹

## ğŸ¯ ä¸‹ä¸€æ­¥

1. é›†æˆåˆ°v5.0ä¸»ç³»ç»Ÿä¸­
2. ä¸v4.1è¿›è¡Œå¯¹æ¯”æµ‹è¯•
3. ä¼˜åŒ–å¥–åŠ±å‚æ•°
4. æ·»åŠ æ›´å¤šå¥–åŠ±é¡¹

## ğŸ“ æ€»ç»“

æˆåŠŸå®ç°äº†v5.0çš„å¤æ‚å¥–åŠ±æœºåˆ¶ï¼Œå®Œå…¨ç¬¦åˆv5.0æ¶æ„åŸåˆ™ï¼š
- âœ… é…ç½®é©±åŠ¨
- âœ… æ¨¡å—åŒ–è®¾è®¡
- âœ… å¥‘çº¦æ¥å£
- âœ… å¯æ‰©å±•æ€§
- âœ… æµ‹è¯•è¦†ç›–

è¿™ä¸ºv5.0ç³»ç»Ÿæä¾›äº†å¼ºå¤§çš„å¥–åŠ±è®¡ç®—èƒ½åŠ›ï¼Œæ”¯æŒå¤æ‚çš„å¤šæ™ºèƒ½ä½“å¼ºåŒ–å­¦ä¹ è®­ç»ƒã€‚
