# v5.0 è°ƒåº¦å™¨é—®é¢˜åˆ†æ

## ğŸ¯ é—®é¢˜æè¿°

**ä½ çš„é—®é¢˜**: "æˆ‘çš„æœˆä»½è½®æ¬¡æ˜¯ä¸€ä¸ªæœˆä¸ºINDï¼Œä¸‹ä¸ªæœˆåˆ™åº”è¯¥æ˜¯COUNCILå’ŒEDUåŒæ—¶æ‰§è¡Œï¼Œæˆ‘æœ‰å°è±¡å½“æ—¶åšäº†è¿™ä¸ªé…ç½®ï¼Œä¸ºä»€ä¹ˆç°åœ¨çš„æ‰§è¡Œè¿‡ç¨‹åˆæ˜¯æ¯ä¸ªagentä¸€ä¸ªæœˆå‘¢ï¼Ÿ"

**ç­”æ¡ˆ**: è°ƒåº¦å™¨é…ç½®æ˜¯æ­£ç¡®çš„ï¼Œä½†ç¯å¢ƒå®ç°æœ‰é—®é¢˜ï¼

## ğŸ“Š é…ç½®åˆ†æ

### **è°ƒåº¦å™¨é…ç½®**
```json
"scheduler": {
  "name": "phase_cycle",
  "params": {
    "step_unit": "month",
    "period": 2,
    "offset": 0,
    "phases": [
      { "agents": ["EDU","COUNCIL"], "mode": "concurrent" },
      { "agents": ["IND"],           "mode": "sequential" }
    ]
  }
}
```

**é…ç½®å«ä¹‰**:
- **period: 2** â†’ æ¯2æ­¥åˆ‡æ¢é˜¶æ®µ
- **é˜¶æ®µ0**: EDU+COUNCIL (å¹¶å‘æ‰§è¡Œ)
- **é˜¶æ®µ1**: IND (é¡ºåºæ‰§è¡Œ)
- **é¢„æœŸè¡Œä¸º**: æ¯2æ­¥åˆ‡æ¢é˜¶æ®µï¼Œæ¯æ­¥å†…åˆ‡æ¢æ™ºèƒ½ä½“

## ğŸ” è°ƒåº¦å™¨å®é™…è¡Œä¸ºåˆ†æ

### **30æ­¥è°ƒåº¦è¡Œä¸º**
```
æ­¥éª¤0: é˜¶æ®µ0, æ´»è·ƒæ™ºèƒ½ä½“=[EDU,COUNCIL], æ‰§è¡Œæ¨¡å¼=concurrent, å½“å‰æ™ºèƒ½ä½“=EDU
æ­¥éª¤1: é˜¶æ®µ0, æ´»è·ƒæ™ºèƒ½ä½“=[EDU,COUNCIL], æ‰§è¡Œæ¨¡å¼=concurrent, å½“å‰æ™ºèƒ½ä½“=COUNCIL
æ­¥éª¤2: é˜¶æ®µ1, æ´»è·ƒæ™ºèƒ½ä½“=[IND],        æ‰§è¡Œæ¨¡å¼=sequential, å½“å‰æ™ºèƒ½ä½“=IND
æ­¥éª¤3: é˜¶æ®µ1, æ´»è·ƒæ™ºèƒ½ä½“=[IND],        æ‰§è¡Œæ¨¡å¼=sequential, å½“å‰æ™ºèƒ½ä½“=IND
æ­¥éª¤4: é˜¶æ®µ0, æ´»è·ƒæ™ºèƒ½ä½“=[EDU,COUNCIL], æ‰§è¡Œæ¨¡å¼=concurrent, å½“å‰æ™ºèƒ½ä½“=EDU
æ­¥éª¤5: é˜¶æ®µ0, æ´»è·ƒæ™ºèƒ½ä½“=[EDU,COUNCIL], æ‰§è¡Œæ¨¡å¼=concurrent, å½“å‰æ™ºèƒ½ä½“=COUNCIL
...
```

### **é˜¶æ®µåˆ‡æ¢æ¨¡å¼**
- **æ­¥éª¤0-1**: é˜¶æ®µ0 (EDU+COUNCILå¹¶å‘)
- **æ­¥éª¤2-3**: é˜¶æ®µ1 (INDé¡ºåº)
- **æ­¥éª¤4-5**: é˜¶æ®µ0 (EDU+COUNCILå¹¶å‘)
- **æ­¥éª¤6-7**: é˜¶æ®µ1 (INDé¡ºåº)
- **...**: æ¯2æ­¥åˆ‡æ¢ä¸€æ¬¡

## ğŸš¨ é—®é¢˜æ ¹æºåˆ†æ

### **1. è°ƒåº¦å™¨é…ç½®æ­£ç¡®**
- âœ… **period: 2** â†’ æ¯2æ­¥åˆ‡æ¢é˜¶æ®µ
- âœ… **phases**: [EDU+COUNCIL, IND] â†’ æ­£ç¡®çš„é˜¶æ®µé…ç½®
- âœ… **mode**: concurrent/sequential â†’ æ­£ç¡®çš„æ‰§è¡Œæ¨¡å¼

### **2. è°ƒåº¦å™¨é€»è¾‘æ­£ç¡®**
- âœ… **é˜¶æ®µåˆ‡æ¢**: æ¯2æ­¥åˆ‡æ¢ä¸€æ¬¡ (æ­¥éª¤2,4,6,8...)
- âœ… **æ™ºèƒ½ä½“åˆ‡æ¢**: æ¯æ­¥åˆ‡æ¢æ™ºèƒ½ä½“ (EDUâ†’COUNCILâ†’INDâ†’INDâ†’EDUâ†’COUNCIL...)
- âœ… **æ‰§è¡Œæ¨¡å¼**: æ­£ç¡®çš„å¹¶å‘/é¡ºåºæ¨¡å¼

### **3. ç¯å¢ƒå®ç°æœ‰é—®é¢˜**
```python
def _should_switch_agent(self) -> bool:
    """æ£€æŸ¥æ˜¯å¦éœ€è¦åˆ‡æ¢æ™ºèƒ½ä½“"""
    # ç®€åŒ–å®ç°ï¼šæ¯ä¸ªæ™ºèƒ½ä½“æ‰§è¡Œä¸€æ­¥ååˆ‡æ¢
    return True  # âŒ é—®é¢˜åœ¨è¿™é‡Œï¼
```

**é—®é¢˜**: ç¯å¢ƒæ¯æ­¥éƒ½åˆ‡æ¢æ™ºèƒ½ä½“ï¼Œæ²¡æœ‰è€ƒè™‘è°ƒåº¦å™¨çš„é˜¶æ®µé€»è¾‘ï¼

## ğŸ”§ é—®é¢˜è¯¦ç»†åˆ†æ

### **å½“å‰ç¯å¢ƒè¡Œä¸º**
```
æ­¥éª¤0: æ™ºèƒ½ä½“=EDU (é˜¶æ®µ0)
æ­¥éª¤1: æ™ºèƒ½ä½“=COUNCIL (é˜¶æ®µ0) â† æ­£ç¡®
æ­¥éª¤2: æ™ºèƒ½ä½“=IND (é˜¶æ®µ1) â† æ­£ç¡®
æ­¥éª¤3: æ™ºèƒ½ä½“=IND (é˜¶æ®µ1) â† æ­£ç¡®
æ­¥éª¤4: æ™ºèƒ½ä½“=EDU (é˜¶æ®µ0) â† æ­£ç¡®
æ­¥éª¤5: æ™ºèƒ½ä½“=COUNCIL (é˜¶æ®µ0) â† æ­£ç¡®
```

### **ä½ æœŸæœ›çš„è¡Œä¸º**
```
æœˆä»½0: INDæ‰§è¡Œ
æœˆä»½1: EDU+COUNCILåŒæ—¶æ‰§è¡Œ
æœˆä»½2: INDæ‰§è¡Œ
æœˆä»½3: EDU+COUNCILåŒæ—¶æ‰§è¡Œ
...
```

### **å®é™…å‘ç”Ÿçš„è¡Œä¸º**
```
æ­¥éª¤0: EDUæ‰§è¡Œ
æ­¥éª¤1: COUNCILæ‰§è¡Œ
æ­¥éª¤2: INDæ‰§è¡Œ
æ­¥éª¤3: INDæ‰§è¡Œ
æ­¥éª¤4: EDUæ‰§è¡Œ
æ­¥éª¤5: COUNCILæ‰§è¡Œ
...
```

## ğŸ¯ é—®é¢˜æ€»ç»“

### **é…ç½®æ˜¯æ­£ç¡®çš„**
- âœ… è°ƒåº¦å™¨é…ç½®: period=2, phases=[EDU+COUNCIL, IND]
- âœ… é˜¶æ®µé€»è¾‘: æ¯2æ­¥åˆ‡æ¢é˜¶æ®µ
- âœ… æ‰§è¡Œæ¨¡å¼: å¹¶å‘/é¡ºåºæ­£ç¡®

### **ç¯å¢ƒå®ç°æœ‰é—®é¢˜**
- âŒ **æ¯æ­¥åˆ‡æ¢æ™ºèƒ½ä½“**: æ²¡æœ‰è€ƒè™‘é˜¶æ®µé€»è¾‘
- âŒ **æ™ºèƒ½ä½“è½®æ¢**: æ¯æ­¥éƒ½è°ƒç”¨`_switch_agent()`
- âŒ **é˜¶æ®µå¿½ç•¥**: æ²¡æœ‰ä½¿ç”¨è°ƒåº¦å™¨çš„é˜¶æ®µä¿¡æ¯

### **å®é™…æ‰§è¡Œé€»è¾‘**
```
ç¯å¢ƒæ¯æ­¥éƒ½åˆ‡æ¢æ™ºèƒ½ä½“ â†’ æ¯ä¸ªæ™ºèƒ½ä½“æ‰§è¡Œä¸€æ­¥ â†’ çœ‹èµ·æ¥åƒ"æ¯ä¸ªagentä¸€ä¸ªæœˆ"
```

## ğŸ’¡ è§£å†³æ–¹æ¡ˆ

### **æ–¹æ¡ˆ1: ä¿®å¤ç¯å¢ƒæ™ºèƒ½ä½“åˆ‡æ¢é€»è¾‘**
```python
def _should_switch_agent(self) -> bool:
    """æ£€æŸ¥æ˜¯å¦éœ€è¦åˆ‡æ¢æ™ºèƒ½ä½“"""
    # è·å–å½“å‰é˜¶æ®µçš„æ´»è·ƒæ™ºèƒ½ä½“
    active_agents = self.scheduler.get_active_agents(self.current_step)
    
    # å¦‚æœå½“å‰æ™ºèƒ½ä½“ä¸åœ¨æ´»è·ƒåˆ—è¡¨ä¸­ï¼Œéœ€è¦åˆ‡æ¢
    if self.current_agent not in active_agents:
        return True
    
    # å¦‚æœå½“å‰é˜¶æ®µæœ‰å¤šä¸ªæ™ºèƒ½ä½“ï¼Œéœ€è¦è½®æ¢
    if len(active_agents) > 1:
        return True
    
    # å¦åˆ™ä¸éœ€è¦åˆ‡æ¢
    return False
```

### **æ–¹æ¡ˆ2: ä¿®å¤æ™ºèƒ½ä½“åˆ‡æ¢é€»è¾‘**
```python
def _switch_agent(self):
    """åˆ‡æ¢æ™ºèƒ½ä½“"""
    # è·å–å½“å‰é˜¶æ®µçš„æ´»è·ƒæ™ºèƒ½ä½“
    active_agents = self.scheduler.get_active_agents(self.current_step)
    
    if not active_agents:
        return
    
    # å¦‚æœå½“å‰æ™ºèƒ½ä½“ä¸åœ¨æ´»è·ƒåˆ—è¡¨ä¸­ï¼Œé€‰æ‹©ç¬¬ä¸€ä¸ª
    if self.current_agent not in active_agents:
        self.current_agent = active_agents[0]
        return
    
    # è½®æ¢åˆ°ä¸‹ä¸€ä¸ªæ´»è·ƒæ™ºèƒ½ä½“
    current_index = active_agents.index(self.current_agent)
    next_index = (current_index + 1) % len(active_agents)
    self.current_agent = active_agents[next_index]
```

## ğŸ“ æ€»ç»“

**ä½ çš„é…ç½®æ˜¯æ­£ç¡®çš„**ï¼Œé—®é¢˜åœ¨äºç¯å¢ƒå®ç°ï¼š

1. **è°ƒåº¦å™¨é…ç½®**: âœ… æ­£ç¡® (period=2, phases=[EDU+COUNCIL, IND])
2. **è°ƒåº¦å™¨é€»è¾‘**: âœ… æ­£ç¡® (æ¯2æ­¥åˆ‡æ¢é˜¶æ®µ)
3. **ç¯å¢ƒå®ç°**: âŒ æœ‰é—®é¢˜ (æ¯æ­¥éƒ½åˆ‡æ¢æ™ºèƒ½ä½“)

**è§£å†³æ–¹æ¡ˆ**: ä¿®å¤ç¯å¢ƒçš„æ™ºèƒ½ä½“åˆ‡æ¢é€»è¾‘ï¼Œä½¿å…¶éµå¾ªè°ƒåº¦å™¨çš„é˜¶æ®µé€»è¾‘ã€‚

**ä½ çš„å°è±¡æ˜¯å¯¹çš„**ï¼Œé…ç½®ç¡®å®æ˜¯æŒ‰ç…§æœˆä»½è½®æ¬¡è®¾è®¡çš„ï¼ ğŸ¯

